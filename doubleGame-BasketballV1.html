<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>åŒäººç¯®çƒ Â· 1åˆ†é’Ÿç«é€ŸæŠ•ç¯®</title>
	<style>
		* {
			box-sizing: border-box;
			user-select: none;
			-webkit-tap-highlight-color: transparent;
		}
		body {
			margin: 0;
			min-height: 100vh;
			background: linear-gradient(145deg, #b95e1a, #8b4513);
			display: flex;
			justify-content: center;
			align-items: center;
			font-family: 'Segoe UI', Roboto, sans-serif;
			padding: 10px;
			touch-action: pan-y pinch-zoom;
		}
		.game-container {
			width: 100%;
			max-width: 500px;
			background: #d2691e;
			border-radius: 40px;
			padding: 20px;
			box-shadow: 0 20px 35px #00000080;
			border: 3px solid #ffd700;
		}
		.header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			color: #ffffff;
			font-size: 1.2rem;
			font-weight: 700;
			margin-bottom: 15px;
			padding: 0 10px;
		}
		.score-board {
			background: #8b4513;
			padding: 8px 30px;
			border-radius: 40px;
			display: flex;
			gap: 40px;
			border: 2px solid #ffd700;
		}
		.score-left, .score-right {
			display: flex;
			align-items: center;
			gap: 8px;
			font-size: 1.3rem;
			color: white;
		}
		.score-left span, .score-right span {
			font-size: 2rem;
			color: #ffd700;
			min-width: 40px;
			text-align: center;
		}
		.timer-box {
			background: #0a0a0a;
			color: #ffd700;
			padding: 5px 20px;
			border-radius: 40px;
			font-size: 1.5rem;
			font-weight: bold;
			border: 2px solid #ffd700;
		}
		.phase-box {
			background: #4a2a0a;
			color: #ffd700;
			padding: 5px 15px;
			border-radius: 30px;
			font-size: 1rem;
			border: 1px solid #ffd700;
		}
		canvas {
			display: block;
			margin: 0 auto;
			width: 100%;
			aspect-ratio: 1/1;
			border-radius: 30px;
			background: #f4a460;
			box-shadow: inset 0 0 30px #00000099, 0 10px 15px black;
			border: 4px solid #8b4513;
			touch-action: none;
		}
		.controls-row {
			display: flex;
			justify-content: space-between;
			margin-top: 20px;
			gap: 15px;
		}
		.player-controls {
			flex: 1;
			display: flex;
			flex-direction: column;
			align-items: center;
			background: #8b4513;
			border-radius: 30px;
			padding: 15px 10px;
			border: 2px solid #ffd700;
		}
		.player-label {
			color: #ffffff;
			font-weight: bold;
			margin-bottom: 12px;
			font-size: 1.1rem;
		}
		.player-label.left {
			color: #3b82f6;
		}
		.player-label.right {
			color: #dc2626;
		}
		.player-controls.left {
			border-color: #3b82f6;
		}
		.player-controls.right {
			border-color: #dc2626;
		}
		
		/* ä¸‰é”®å¸ƒå±€ */
		.three-keys {
			display: grid;
			grid-template-columns: 1fr 1fr 1fr;
			gap: 8px;
			width: 100%;
		}
		.key-left {
			grid-column: 1;
			grid-row: 1;
		}
		.key-shoot {
			grid-column: 2;
			grid-row: 1;
		}
		.key-right {
			grid-column: 3;
			grid-row: 1;
		}
		
		.ctrl-btn {
			background: #2d4b6e;
			border: none;
			color: white;
			font-size: 1.8rem;
			font-weight: bold;
			aspect-ratio: 1/1;
			width: 100%;
			border-radius: 20px;
			box-shadow: 0 5px 0 #0e2637;
			transition: 0.05s;
			display: flex;
			align-items: center;
			justify-content: center;
			touch-action: manipulation;
			cursor: pointer;
			-webkit-tap-highlight-color: transparent;
		}
		.ctrl-btn:active {
			transform: translateY(4px);
			box-shadow: 0 1px 0 #0e2637;
		}
		.ctrl-btn.left-color {
			background: #3b82f6;
		}
		.ctrl-btn.right-color {
			background: #dc2626;
		}
		.shoot-btn {
			background: #ffd700;
			color: #1e2f47;
			font-size: 1.5rem;
		}
		.footer {
			text-align: center;
			margin-top: 15px;
			color: #ffffff;
			font-size: 0.9rem;
		}
		.victory-message {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: rgba(0,0,0,0.9);
			color: gold;
			font-size: 2rem;
			font-weight: bold;
			padding: 30px 50px;
			border-radius: 60px;
			border: 4px solid gold;
			z-index: 1000;
			display: none;
			text-align: center;
			backdrop-filter: blur(10px);
		}
		.restart-btn {
			background: #ffd700;
			border: none;
			color: #1e2f47;
			font-size: 1.2rem;
			padding: 10px 30px;
			border-radius: 40px;
			margin-top: 15px;
			font-weight: bold;
			cursor: pointer;
		}
	</style>
</head>
<body>
	<div class="victory-message" id="victoryMessage">
		ğŸ† è·èƒœ ğŸ†
		<div><button class="restart-btn" onclick="location.reload()">å†ç©ä¸€å±€</button></div>
	</div>

	<div class="game-container">
		<div class="header">
			<span>ğŸ€ åŒäººç¯®çƒ Â· 1åˆ†é’Ÿç«é€Ÿ</span>
			<div class="timer-box" id="timer">01:00</div>
		</div>
		<div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
			<div class="phase-box" id="phaseDisplay">âš¡ ç¯®ç­é™æ­¢</div>
			<div class="score-board">
				<div class="score-left">ğŸ”µ <span id="scoreLeft">0</span></div>
				<div class="score-right">ğŸ”´ <span id="scoreRight">0</span></div>
			</div>
		</div>

		<canvas id="gameCanvas" width="400" height="400"></canvas>

		<!-- åŒäººæ§åˆ¶åŒºåŸŸ - ä¸‰é”®å¸ƒå±€ -->
		<div class="controls-row">
			<!-- å·¦ä¾§ç©å®¶ (è“è‰²) - å·¦å³+æŠ•ç¯® -->
			<div class="player-controls left">
				<div class="player-label left">ğŸ‘ˆ è“é˜Ÿ</div>
				<div class="three-keys">
					<div class="key-left">
						<button class="ctrl-btn left-color" id="leftLeft">â¬…ï¸</button>
					</div>
					<div class="key-shoot">
						<button class="ctrl-btn left-color shoot-btn" id="leftShoot">ğŸ€</button>
					</div>
					<div class="key-right">
						<button class="ctrl-btn left-color" id="leftRight">â¡ï¸</button>
					</div>
				</div>
				<div style="margin-top: 5px; color: #a5d8ff; font-size: 0.8rem;">å·¦å³ç„å‡† Â· ä¸­å¤®æŠ•ç¯®</div>
			</div>

			<!-- å³ä¾§ç©å®¶ (çº¢è‰²) - å·¦å³+æŠ•ç¯® -->
			<div class="player-controls right">
				<div class="player-label right">ğŸ‘‰ çº¢é˜Ÿ</div>
				<div class="three-keys">
					<div class="key-left">
						<button class="ctrl-btn right-color" id="rightLeft">â¬…ï¸</button>
					</div>
					<div class="key-shoot">
						<button class="ctrl-btn right-color shoot-btn" id="rightShoot">ğŸ€</button>
					</div>
					<div class="key-right">
						<button class="ctrl-btn right-color" id="rightRight">â¡ï¸</button>
					</div>
				</div>
				<div style="margin-top: 5px; color: #ffa5a5; font-size: 0.8rem;">å·¦å³ç„å‡† Â· ä¸­å¤®æŠ•ç¯®</div>
			</div>
		</div>

		<div class="footer">
			å‰30ç§’ç¯®ç­é™æ­¢ï¼Œå30ç§’ç§»åŠ¨ Â· çœ‹è°æŠ•å¾—å¤šï¼
		</div>
	</div>

	<script>
		(function() {
			const canvas = document.getElementById('gameCanvas');
			const ctx = canvas.getContext('2d');
			const victoryMsg = document.getElementById('victoryMessage');
			const timerEl = document.getElementById('timer');
			const phaseEl = document.getElementById('phaseDisplay');

			// æ¸¸æˆé…ç½®
			const config = {
				ballRadius: 6,
				hoopRadius: 15,
				hoopSpeed: 2,
				totalTime: 60, // 1åˆ†é’Ÿ
				moveStartTime: 30 // 30ç§’åå¼€å§‹ç§»åŠ¨
			};

			// ç¯®ç­ä½ç½® - åˆå§‹åœ¨ä¸­å¤®åä¸Š
			let hoop = {
				x: 200,
				y: 100,
				r: config.hoopRadius,
				vx: 1,
				vy: 0.5,
				phase: 'static' // static æˆ– moving
			};

			// ç¯®çƒ
			let balls = [];

			// æŠ•ç¯®æ–¹å‘ï¼ˆæ¯ä¸ªç©å®¶ä¸€ä¸ªï¼‰
			let leftDirection = 0; // -1 å·¦, 0 ä¸­, 1 å³
			let rightDirection = 0;

			// åˆ†æ•°
			let leftScore = 0;
			let rightScore = 0;

			// è®¡æ—¶
			let timeLeft = config.totalTime;
			let gameActive = true;
			let gameStarted = false;
			let gameInterval = null;

			// åˆ†æ•°æ˜¾ç¤º
			const scoreLeftEl = document.getElementById('scoreLeft');
			const scoreRightEl = document.getElementById('scoreRight');

			// ç§»åŠ¨çŠ¶æ€
			const leftKeys = { left: false, right: false };
			const rightKeys = { left: false, right: false };

			// è§¦æ‘¸ç»‘å®š
			function bindButton(btnId, playerKeys, dir) {
				const btn = document.getElementById(btnId);
				if (!btn) return;
				
				const setState = (value) => {
					playerKeys[dir] = value;
					
					// æ›´æ–°æ–¹å‘æ˜¾ç¤º
					if (btnId.includes('left')) {
						if (playerKeys.left && !playerKeys.right) leftDirection = -1;
						else if (!playerKeys.left && playerKeys.right) leftDirection = 1;
						else leftDirection = 0;
					} else {
						if (playerKeys.left && !playerKeys.right) rightDirection = -1;
						else if (!playerKeys.left && playerKeys.right) rightDirection = 1;
						else rightDirection = 0;
					}
				};
				
				btn.addEventListener('touchstart', (e) => {
					e.preventDefault();
					setState(true);
				});
				btn.addEventListener('touchend', (e) => {
					e.preventDefault();
					setState(false);
				});
				btn.addEventListener('touchcancel', (e) => {
					e.preventDefault();
					setState(false);
				});
				btn.addEventListener('mousedown', (e) => {
					e.preventDefault();
					setState(true);
				});
				btn.addEventListener('mouseup', (e) => {
					e.preventDefault();
					setState(false);
				});
				btn.addEventListener('mouseleave', (e) => {
					setState(false);
				});
			}

			bindButton('leftLeft', leftKeys, 'left');
			bindButton('leftRight', leftKeys, 'right');
			bindButton('rightLeft', rightKeys, 'left');
			bindButton('rightRight', rightKeys, 'right');

			// æŠ•ç¯®
			document.getElementById('leftShoot').addEventListener('touchstart', (e) => {
				e.preventDefault();
				shoot('left');
			});
			document.getElementById('leftShoot').addEventListener('mousedown', (e) => {
				e.preventDefault();
				shoot('left');
			});
			document.getElementById('rightShoot').addEventListener('touchstart', (e) => {
				e.preventDefault();
				shoot('right');
			});
			document.getElementById('rightShoot').addEventListener('mousedown', (e) => {
				e.preventDefault();
				shoot('right');
			});

			function shoot(side) {
				if (!gameActive || !gameStarted) return;
				
				const direction = side === 'left' ? leftDirection : rightDirection;
				const startX = side === 'left' ? 100 : 300;
				const startY = 350;
				
				// æ ¹æ®æ–¹å‘è®¡ç®—åˆé€Ÿåº¦
				let vx = 0;
				if (direction === -1) vx = -4;
				else if (direction === 1) vx = 4;
				else vx = 0;
				
				balls.push({
					x: startX,
					y: startY,
					r: config.ballRadius,
					vx: vx,
					vy: -10, // å‘ä¸ŠæŠ›
					side: side,
					active: true
				});
			}

			// é‡ç½®æ¸¸æˆ
			function resetGame() {
				leftScore = 0;
				rightScore = 0;
				timeLeft = config.totalTime;
				gameActive = true;
				gameStarted = true;
				balls = [];
				hoop.phase = 'static';
				hoop.x = 200;
				hoop.y = 100;
				phaseEl.innerText = 'âš¡ ç¯®ç­é™æ­¢';
				
				scoreLeftEl.innerText = leftScore;
				scoreRightEl.innerText = rightScore;
				
				if (gameInterval) clearInterval(gameInterval);
				gameInterval = setInterval(updateTimer, 1000);
			}

			// æ›´æ–°è®¡æ—¶å™¨
			function updateTimer() {
				if (!gameActive || !gameStarted) return;
				
				timeLeft--;
				const mins = Math.floor(timeLeft / 60);
				const secs = timeLeft % 60;
				timerEl.innerText = `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
				
				// 30ç§’åç¯®ç­å¼€å§‹ç§»åŠ¨
				if (timeLeft === config.moveStartTime) {
					hoop.phase = 'moving';
					phaseEl.innerText = 'ğŸŒ€ ç¯®ç­ç§»åŠ¨';
				}
				
				if (timeLeft <= 0) {
					gameActive = false;
					clearInterval(gameInterval);
					
					// æ˜¾ç¤ºèƒœåˆ©ä¿¡æ¯
					let winner = '';
					if (leftScore > rightScore) winner = 'ğŸ† è“é˜Ÿèƒœåˆ© ğŸ†';
					else if (rightScore > leftScore) winner = 'ğŸ† çº¢é˜Ÿèƒœåˆ© ğŸ†';
					else winner = 'ğŸ¤ å¹³å±€';
					
					victoryMsg.style.display = 'block';
					victoryMsg.innerHTML = `${winner}<div><button class="restart-btn" onclick="location.reload()">å†ç©ä¸€å±€</button></div>`;
				}
			}

			// æ›´æ–°ç¯®ç­ä½ç½®
			function updateHoop() {
				if (hoop.phase === 'moving') {
					hoop.x += hoop.vx * config.hoopSpeed;
					hoop.y += hoop.vy * config.hoopSpeed;
					
					// è¾¹ç•Œåå¼¹
					if (hoop.x - hoop.r < 0) {
						hoop.x = hoop.r;
						hoop.vx = -hoop.vx;
					} else if (hoop.x + hoop.r > canvas.width) {
						hoop.x = canvas.width - hoop.r;
						hoop.vx = -hoop.vx;
					}
					
					if (hoop.y - hoop.r < 0) {
						hoop.y = hoop.r;
						hoop.vy = -hoop.vy;
					} else if (hoop.y + hoop.r > canvas.height) {
						hoop.y = canvas.height - hoop.r;
						hoop.vy = -hoop.vy;
					}
				}
			}

			// æ›´æ–°ç¯®çƒ
			function updateBalls() {
				for (let i = balls.length - 1; i >= 0; i--) {
					const b = balls[i];
					
					// é‡åŠ›
					b.vy += 0.3;
					
					// ç§»åŠ¨
					b.x += b.vx;
					b.y += b.vy;
					
					// è¾¹ç•Œåå¼¹ï¼ˆé™¤äº†ç¯®ç­åŒºåŸŸï¼‰
					if (b.x - b.r < 0) {
						b.x = b.r;
						b.vx = -b.vx * 0.5;
					} else if (b.x + b.r > canvas.width) {
						b.x = canvas.width - b.r;
						b.vx = -b.vx * 0.5;
					}
					
					if (b.y - b.r < 0) {
						b.y = b.r;
						b.vy = -b.vy * 0.5;
					} else if (b.y + b.r > canvas.height) {
						// è½åœ°æ¶ˆå¤±
						balls.splice(i, 1);
						continue;
					}
					
					// æ£€æŸ¥æ˜¯å¦è¿›ç¯®ç­
					const dx = b.x - hoop.x;
					const dy = b.y - hoop.y;
					const dist = Math.sqrt(dx*dx + dy*dy);
					
					// å¦‚æœçƒç©¿è¿‡ç¯®ç­åŒºåŸŸä¸”é€Ÿåº¦å‘ä¸‹ï¼ˆæ­£åœ¨ä¸‹è½ï¼‰
					if (dist < hoop.r + b.r && b.vy > 0) {
						if (b.side === 'left') {
							leftScore++;
							scoreLeftEl.innerText = leftScore;
						} else {
							rightScore++;
							scoreRightEl.innerText = rightScore;
						}
						balls.splice(i, 1);
						
						// ç¯®ç­é—ªä¸€ä¸‹
						hoop.r = config.hoopRadius + 5;
						setTimeout(() => hoop.r = config.hoopRadius, 100);
					}
				}
			}

			// ç»˜åˆ¶æ–¹å‘æŒ‡ç¤ºå™¨
			function drawDirection(side, direction) {
				let x, y;
				if (side === 'left') {
					x = 100;
					y = 380;
				} else {
					x = 300;
					y = 380;
				}
				
				ctx.fillStyle = side === 'left' ? '#3b82f6' : '#dc2626';
				ctx.beginPath();
				ctx.arc(x, y, 12, 0, Math.PI*2);
				ctx.fill();
				
				// æ–¹å‘ç®­å¤´
				ctx.fillStyle = 'white';
				ctx.font = 'bold 14px sans-serif';
				if (direction === -1) {
					ctx.fillText('â†', x - 18, y + 5);
				} else if (direction === 1) {
					ctx.fillText('â†’', x + 12, y + 5);
				} else {
					ctx.fillText('â—', x - 4, y + 5);
				}
			}

			// ç»˜åˆ¶
			function draw() {
				ctx.clearRect(0, 0, canvas.width, canvas.height);

				// ç»˜åˆ¶çƒåœº
				ctx.fillStyle = '#f4a460';
				ctx.fillRect(0, 0, canvas.width, canvas.height);
				
				// ç»˜åˆ¶ä¸‰åˆ†çº¿
				ctx.strokeStyle = '#ffffff55';
				ctx.lineWidth = 2;
				ctx.beginPath();
				ctx.arc(200, 200, 120, 0, Math.PI*2);
				ctx.stroke();
				
				// ç»˜åˆ¶ç½šçƒçº¿
				ctx.beginPath();
				ctx.moveTo(100, 150);
				ctx.lineTo(300, 150);
				ctx.stroke();

				// ç»˜åˆ¶ç¯®ç­
				ctx.shadowBlur = 20;
				ctx.shadowColor = '#00000080';
				
				// ç¯®ç­å¤–åœˆ
				ctx.beginPath();
				ctx.arc(hoop.x, hoop.y, hoop.r, 0, Math.PI*2);
				ctx.fillStyle = '#ffd700';
				ctx.fill();
				ctx.strokeStyle = '#b8860b';
				ctx.lineWidth = 4;
				ctx.stroke();
				
				// ç¯®ç½‘
				ctx.beginPath();
				ctx.moveTo(hoop.x - 10, hoop.y + 5);
				ctx.lineTo(hoop.x, hoop.y + 20);
				ctx.lineTo(hoop.x + 10, hoop.y + 5);
				ctx.strokeStyle = '#ffffff';
				ctx.lineWidth = 2;
				ctx.stroke();
				
				// ç¯®ç­ä¸­å¿ƒç‚¹
				ctx.beginPath();
				ctx.arc(hoop.x, hoop.y, 4, 0, Math.PI*2);
				ctx.fillStyle = '#b8860b';
				ctx.fill();

				// ç»˜åˆ¶ç¯®çƒ
				for (let b of balls) {
					ctx.beginPath();
					ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
					
					// ç¯®çƒçº¹ç†
					const gradient = ctx.createRadialGradient(
						b.x - 2, b.y - 2, 2,
						b.x, b.y, b.r + 4
					);
					gradient.addColorStop(0, '#ff8c00');
					gradient.addColorStop(0.7, '#d2691e');
					gradient.addColorStop(1, '#8b4513');
					
					ctx.fillStyle = gradient;
					ctx.fill();
					
					// ç¯®çƒé»‘çº¿
					ctx.strokeStyle = '#000000';
					ctx.lineWidth = 1;
					ctx.beginPath();
					ctx.moveTo(b.x - 4, b.y - 4);
					ctx.lineTo(b.x + 4, b.y + 4);
					ctx.moveTo(b.x + 4, b.y - 4);
					ctx.lineTo(b.x - 4, b.y + 4);
					ctx.stroke();
				}

				// ç»˜åˆ¶æ–¹å‘æŒ‡ç¤ºå™¨
				drawDirection('left', leftDirection);
				drawDirection('right', rightDirection);

				// ç»˜åˆ¶å‡ºæ‰‹ç‚¹
				ctx.fillStyle = '#3b82f6';
				ctx.beginPath();
				ctx.arc(100, 350, 10, 0, Math.PI*2);
				ctx.fill();
				
				ctx.fillStyle = '#dc2626';
				ctx.beginPath();
				ctx.arc(300, 350, 10, 0, Math.PI*2);
				ctx.fill();

				// ç»˜åˆ¶åˆ†æ•°èƒŒæ™¯
				ctx.shadowBlur = 0;
				ctx.fillStyle = '#00000080';
				ctx.font = 'bold 36px monospace';
				ctx.fillText(leftScore, 50, 80);
				ctx.fillText(rightScore, canvas.width - 90, 80);
			}

			// æ¸¸æˆå¾ªç¯
			function gameLoop() {
				if (gameActive && gameStarted) {
					updateHoop();
					updateBalls();
				}
				draw();
				requestAnimationFrame(gameLoop);
			}

			// è‡ªåŠ¨å¼€å§‹
			resetGame();
			gameLoop();

			// é˜»æ­¢æ»šåŠ¨
			document.body.addEventListener('touchmove', (e) => {
				if (e.target.closest('button')) {
					e.preventDefault();
				}
			}, { passive: false });
		})();
	</script>
</body>
</html>