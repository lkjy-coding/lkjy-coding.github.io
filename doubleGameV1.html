<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>åŒäººæ°”çƒå¤§æˆ˜ Â· ç§»åŠ¨åŒå±</title>
	<style>
		* {
			box-sizing: border-box;
			user-select: none;
			-webkit-tap-highlight-color: transparent;
		}
		body {
			margin: 0;
			min-height: 100vh;
			background: linear-gradient(145deg, #0b1c2f, #1a2f42);
			display: flex;
			justify-content: center;
			align-items: center;
			font-family: 'Segoe UI', Roboto, sans-serif;
			padding: 10px;
			touch-action: pan-y pinch-zoom;
		}
		.game-container {
			width: 100%;
			max-width: 500px;
			background: #1e3a5f;
			border-radius: 40px;
			padding: 20px;
			box-shadow: 0 20px 35px #00000080;
			border: 2px solid #4c7aa2;
		}
		.header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			color: #e6f0ff;
			font-size: 1.2rem;
			font-weight: 700;
			margin-bottom: 15px;
			padding: 0 10px;
		}
		.score-board {
			background: #0f2a40;
			padding: 8px 20px;
			border-radius: 40px;
			display: flex;
			gap: 30px;
		}
		.score-left, .score-right {
			display: flex;
			align-items: center;
			gap: 5px;
		}
		.score-left span, .score-right span {
			font-size: 1.5rem;
			color: #ffb347;
		}
		canvas {
			display: block;
			margin: 0 auto;
			width: 100%;
			aspect-ratio: 1/1;
			border-radius: 30px;
			background: #87CEEB;
			box-shadow: inset 0 0 20px #00000055, 0 10px 15px black;
			border: 4px solid #5f8db0;
			touch-action: none;
		}
		.controls-row {
			display: flex;
			justify-content: space-between;
			margin-top: 20px;
			gap: 10px;
		}
		.player-controls {
			flex: 1;
			display: flex;
			flex-direction: column;
			align-items: center;
			background: #0f2a40;
			border-radius: 30px;
			padding: 15px 10px;
			border: 2px solid #3a6792;
		}
		.player-label {
			color: #d7ecff;
			font-weight: bold;
			margin-bottom: 12px;
			font-size: 1.1rem;
		}
		.player-label.left {
			color: #3b82f6;
		}
		.player-label.right {
			color: #dc2626;
		}
		.button-grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 8px;
			width: 100%;
		}
		.ctrl-btn {
			background: #2d4b6e;
			border: none;
			color: white;
			font-size: 1.8rem;
			font-weight: bold;
			aspect-ratio: 1/1;
			border-radius: 20px;
			box-shadow: 0 5px 0 #0e2637;
			transition: 0.05s;
			display: flex;
			align-items: center;
			justify-content: center;
			touch-action: manipulation;
			cursor: pointer;
			-webkit-tap-highlight-color: transparent;
		}
		.ctrl-btn:active {
			transform: translateY(4px);
			box-shadow: 0 1px 0 #0e2637;
		}
		.ctrl-btn.left-color {
			background: #3b82f6;
		}
		.ctrl-btn.right-color {
			background: #dc2626;
		}
		.fire-btn {
			grid-column: span 3;
			background: #ffb347;
			color: #1e2f47;
			font-size: 1.5rem;
			padding: 12px 0;
			aspect-ratio: auto;
			border-radius: 30px;
			margin-top: 5px;
		}
		.footer {
			text-align: center;
			margin-top: 15px;
			color: #8aa9c9;
			font-size: 0.9rem;
		}
	</style>
</head>
<body>
	<div class="game-container">
		<div class="header">
			<span>ğŸˆ åŒäººæ°”çƒå¤§æˆ˜</span>
			<div class="score-board">
				<div class="score-left">ğŸ”µ <span id="scoreLeft">0</span></div>
				<div class="score-right">ğŸ”´ <span id="scoreRight">0</span></div>
			</div>
		</div>

		<canvas id="gameCanvas" width="400" height="400"></canvas>

		<!-- åŒäººæ§åˆ¶åŒºåŸŸ -->
		<div class="controls-row">
			<!-- å·¦ä¾§ç©å®¶ (è“è‰²) -->
			<div class="player-controls">
				<div class="player-label left">ğŸ‘ˆ è“æ–¹</div>
				<div class="button-grid">
					<button class="ctrl-btn left-color" id="leftUp">â¬†ï¸</button>
					<button class="ctrl-btn left-color" id="leftDown">â¬‡ï¸</button>
					<button class="ctrl-btn left-color" id="leftLeft">â¬…ï¸</button>
					<button class="ctrl-btn left-color" id="leftRight">â¡ï¸</button>
					<button class="ctrl-btn left-color fire-btn" id="leftFire">ğŸ”¥ å¼€ç«</button>
				</div>
			</div>

			<!-- å³ä¾§ç©å®¶ (çº¢è‰²) -->
			<div class="player-controls">
				<div class="player-label right">ğŸ‘‰ çº¢æ–¹</div>
				<div class="button-grid">
					<button class="ctrl-btn right-color" id="rightUp">â¬†ï¸</button>
					<button class="ctrl-btn right-color" id="rightDown">â¬‡ï¸</button>
					<button class="ctrl-btn right-color" id="rightLeft">â¬…ï¸</button>
					<button class="ctrl-btn right-color" id="rightRight">â¡ï¸</button>
					<button class="ctrl-btn right-color fire-btn" id="rightFire">ğŸ”¥ å¼€ç«</button>
				</div>
			</div>
		</div>
		<div class="footer">
			åŒæ–¹å„æ§åˆ¶è‡ªå·±çš„æ°”çƒï¼Œç”¨å­å¼¹å‡»ä¸­å¯¹æ–¹å¾—åˆ†ï¼
		</div>
	</div>

	<script>
		(function() {
			const canvas = document.getElementById('gameCanvas');
			const ctx = canvas.getContext('2d');

			// æ¸¸æˆé…ç½®
			const config = {
				playerRadius: 20,
				bulletRadius: 6,
				playerSpeed: 4,
				bulletSpeed: 6,
				fireCooldown: 20, // å¸§æ•°å†·å´
				maxBullets: 10
			};

			// ç©å®¶åˆå§‹ä½ç½®
			let leftPlayer = { x: 80, y: 200, r: config.playerRadius };
			let rightPlayer = { x: 320, y: 200, r: config.playerRadius };

			// å­å¼¹æ•°ç»„
			let bullets = [];

			// åˆ†æ•°
			let leftScore = 0;
			let rightScore = 0;

			// å†·å´è®¡æ•°å™¨
			let leftCooldown = 0;
			let rightCooldown = 0;

			// ç§»åŠ¨çŠ¶æ€ (æ¯ä¸ªç©å®¶æœ‰ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘)
			const leftMove = { up: false, down: false, left: false, right: false };
			const rightMove = { up: false, down: false, left: false, right: false };

			// è·å–åˆ†æ•°æ˜¾ç¤ºå…ƒç´ 
			const scoreLeftEl = document.getElementById('scoreLeft');
			const scoreRightEl = document.getElementById('scoreRight');

			// ---------- è§¦æ‘¸äº‹ä»¶ç»‘å®š ----------
			function bindButton(btnId, playerMove, dir) {
				const btn = document.getElementById(btnId);
				if (!btn) return;
				
				btn.addEventListener('touchstart', (e) => {
					e.preventDefault();
					playerMove[dir] = true;
				});
				btn.addEventListener('touchend', (e) => {
					e.preventDefault();
					playerMove[dir] = false;
				});
				btn.addEventListener('touchcancel', (e) => {
					e.preventDefault();
					playerMove[dir] = false;
				});
				// é˜²æ­¢é¼ æ ‡äº‹ä»¶å¹²æ‰°ç§»åŠ¨ç«¯
				btn.addEventListener('mousedown', (e) => {
					e.preventDefault();
					playerMove[dir] = true;
				});
				btn.addEventListener('mouseup', (e) => {
					e.preventDefault();
					playerMove[dir] = false;
				});
				btn.addEventListener('mouseleave', (e) => {
					// å¦‚æœé¼ æ ‡ç¦»å¼€æŒ‰é’®ï¼Œè§†ä¸ºæ¾å¼€
					playerMove[dir] = false;
				});
			}

			// ç»‘å®šç§»åŠ¨æŒ‰é’®
			bindButton('leftUp', leftMove, 'up');
			bindButton('leftDown', leftMove, 'down');
			bindButton('leftLeft', leftMove, 'left');
			bindButton('leftRight', leftMove, 'right');
			bindButton('rightUp', rightMove, 'up');
			bindButton('rightDown', rightMove, 'down');
			bindButton('rightLeft', rightMove, 'left');
			bindButton('rightRight', rightMove, 'right');

			// å¼€ç«æŒ‰é’®
			document.getElementById('leftFire').addEventListener('touchstart', (e) => {
				e.preventDefault();
				if (leftCooldown <= 0) {
					fireBullet('left');
				}
			});
			document.getElementById('leftFire').addEventListener('mousedown', (e) => {
				e.preventDefault();
				if (leftCooldown <= 0) {
					fireBullet('left');
				}
			});

			document.getElementById('rightFire').addEventListener('touchstart', (e) => {
				e.preventDefault();
				if (rightCooldown <= 0) {
					fireBullet('right');
				}
			});
			document.getElementById('rightFire').addEventListener('mousedown', (e) => {
				e.preventDefault();
				if (rightCooldown <= 0) {
					fireBullet('right');
				}
			});

			// å‘å°„å­å¼¹
			function fireBullet(side) {
				if (side === 'left') {
					bullets.push({
						x: leftPlayer.x + 15,
						y: leftPlayer.y,
						vx: config.bulletSpeed,
						vy: 0,
						side: 'left',
						r: config.bulletRadius
					});
					leftCooldown = config.fireCooldown;
				} else {
					bullets.push({
						x: rightPlayer.x - 15,
						y: rightPlayer.y,
						vx: -config.bulletSpeed,
						vy: 0,
						side: 'right',
						r: config.bulletRadius
					});
					rightCooldown = config.fireCooldown;
				}
			}

			// æ›´æ–°ç©å®¶ä½ç½®
			function updatePlayers() {
				// å·¦ç©å®¶ç§»åŠ¨
				if (leftMove.up) leftPlayer.y -= config.playerSpeed;
				if (leftMove.down) leftPlayer.y += config.playerSpeed;
				if (leftMove.left) leftPlayer.x -= config.playerSpeed;
				if (leftMove.right) leftPlayer.x += config.playerSpeed;

				// å³ç©å®¶ç§»åŠ¨
				if (rightMove.up) rightPlayer.y -= config.playerSpeed;
				if (rightMove.down) rightPlayer.y += config.playerSpeed;
				if (rightMove.left) rightPlayer.x -= config.playerSpeed;
				if (rightMove.right) rightPlayer.x += config.playerSpeed;

				// è¾¹ç•Œé™åˆ¶
				leftPlayer.x = Math.max(leftPlayer.r, Math.min(canvas.width/2 - 20, leftPlayer.x));
				leftPlayer.y = Math.max(leftPlayer.r, Math.min(canvas.height - leftPlayer.r, leftPlayer.y));
				
				rightPlayer.x = Math.max(canvas.width/2 + 20, Math.min(canvas.width - rightPlayer.r, rightPlayer.x));
				rightPlayer.y = Math.max(rightPlayer.r, Math.min(canvas.height - rightPlayer.r, rightPlayer.y));
			}

			// æ›´æ–°å­å¼¹
			function updateBullets() {
				// ç§»åŠ¨å­å¼¹
				for (let i = bullets.length - 1; i >= 0; i--) {
					const b = bullets[i];
					b.x += b.vx;
					b.y += b.vy;

					// è¾¹ç•Œç§»é™¤
					if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
						bullets.splice(i, 1);
						continue;
					}

					// ç¢°æ’æ£€æµ‹ (å·¦æ–¹å­å¼¹å‡»ä¸­å³ç©å®¶)
					if (b.side === 'left') {
						const dx = b.x - rightPlayer.x;
						const dy = b.y - rightPlayer.y;
						const dist = Math.sqrt(dx*dx + dy*dy);
						if (dist < b.r + rightPlayer.r) {
							// å³ç©å®¶è¢«å‡»ä¸­
							rightScore++;
							scoreRightEl.innerText = rightScore;
							bullets.splice(i, 1);
							// é‡ç½®ç©å®¶ä½ç½®
							rightPlayer.x = 320;
							rightPlayer.y = 200;
							leftPlayer.x = 80;
							leftPlayer.y = 200;
							continue;
						}
					} 
					// å³æ–¹å­å¼¹å‡»ä¸­å·¦ç©å®¶
					else if (b.side === 'right') {
						const dx = b.x - leftPlayer.x;
						const dy = b.y - leftPlayer.y;
						const dist = Math.sqrt(dx*dx + dy*dy);
						if (dist < b.r + leftPlayer.r) {
							leftScore++;
							scoreLeftEl.innerText = leftScore;
							bullets.splice(i, 1);
							// é‡ç½®ç©å®¶ä½ç½®
							rightPlayer.x = 320;
							rightPlayer.y = 200;
							leftPlayer.x = 80;
							leftPlayer.y = 200;
							continue;
						}
					}
				}

				// æ›´æ–°å†·å´
				if (leftCooldown > 0) leftCooldown--;
				if (rightCooldown > 0) rightCooldown--;
			}

			// ç»˜åˆ¶
			function draw() {
				ctx.clearRect(0, 0, canvas.width, canvas.height);

				// ç»˜åˆ¶ä¸­çº¿
				ctx.strokeStyle = '#ffffff55';
				ctx.lineWidth = 2;
				ctx.setLineDash([10, 10]);
				ctx.beginPath();
				ctx.moveTo(canvas.width/2, 0);
				ctx.lineTo(canvas.width/2, canvas.height);
				ctx.stroke();
				ctx.setLineDash([]);

				// ç»˜åˆ¶è‰åœ°/èƒŒæ™¯
				ctx.fillStyle = '#7cb57c';
				ctx.globalAlpha = 0.3;
				ctx.fillRect(0, 0, canvas.width, canvas.height);
				ctx.globalAlpha = 1;

				// ç»˜åˆ¶å·¦ç©å®¶ (è“è‰²æ°”çƒ)
				ctx.shadowColor = '#00000080';
				ctx.shadowBlur = 10;
				// æ°”çƒç»³
				ctx.beginPath();
				ctx.moveTo(leftPlayer.x, leftPlayer.y + leftPlayer.r - 5);
				ctx.lineTo(leftPlayer.x - 5, leftPlayer.y + leftPlayer.r + 15);
				ctx.lineTo(leftPlayer.x + 5, leftPlayer.y + leftPlayer.r + 15);
				ctx.fillStyle = '#8b5a2b';
				ctx.fill();
				// æ°”çƒ
				ctx.beginPath();
				ctx.arc(leftPlayer.x, leftPlayer.y, leftPlayer.r, 0, Math.PI * 2);
				ctx.fillStyle = '#3b82f6';
				ctx.fill();
				ctx.strokeStyle = '#1e3a8a';
				ctx.lineWidth = 2;
				ctx.stroke();
				// çœ¼ç›
				ctx.fillStyle = '#fff';
				ctx.beginPath();
				ctx.arc(leftPlayer.x - 6, leftPlayer.y - 6, 4, 0, Math.PI*2);
				ctx.fill();
				ctx.beginPath();
				ctx.arc(leftPlayer.x + 6, leftPlayer.y - 6, 4, 0, Math.PI*2);
				ctx.fill();
				ctx.fillStyle = '#000';
				ctx.beginPath();
				ctx.arc(leftPlayer.x - 7, leftPlayer.y - 7, 2, 0, Math.PI*2);
				ctx.fill();
				ctx.beginPath();
				ctx.arc(leftPlayer.x + 5, leftPlayer.y - 7, 2, 0, Math.PI*2);
				ctx.fill();
				// å¾®ç¬‘
				ctx.beginPath();
				ctx.strokeStyle = '#000';
				ctx.lineWidth = 2;
				ctx.arc(leftPlayer.x, leftPlayer.y + 2, 6, 0.1, Math.PI - 0.1);
				ctx.stroke();

				// ç»˜åˆ¶å³ç©å®¶ (çº¢è‰²æ°”çƒ)
				ctx.beginPath();
				ctx.moveTo(rightPlayer.x, rightPlayer.y + rightPlayer.r - 5);
				ctx.lineTo(rightPlayer.x - 5, rightPlayer.y + rightPlayer.r + 15);
				ctx.lineTo(rightPlayer.x + 5, rightPlayer.y + rightPlayer.r + 15);
				ctx.fillStyle = '#8b5a2b';
				ctx.fill();
				ctx.beginPath();
				ctx.arc(rightPlayer.x, rightPlayer.y, rightPlayer.r, 0, Math.PI * 2);
				ctx.fillStyle = '#dc2626';
				ctx.fill();
				ctx.strokeStyle = '#991b1b';
				ctx.lineWidth = 2;
				ctx.stroke();
				// çœ¼ç›
				ctx.fillStyle = '#fff';
				ctx.beginPath();
				ctx.arc(rightPlayer.x - 6, rightPlayer.y - 6, 4, 0, Math.PI*2);
				ctx.fill();
				ctx.beginPath();
				ctx.arc(rightPlayer.x + 6, rightPlayer.y - 6, 4, 0, Math.PI*2);
				ctx.fill();
				ctx.fillStyle = '#000';
				ctx.beginPath();
				ctx.arc(rightPlayer.x - 7, rightPlayer.y - 7, 2, 0, Math.PI*2);
				ctx.fill();
				ctx.beginPath();
				ctx.arc(rightPlayer.x + 5, rightPlayer.y - 7, 2, 0, Math.PI*2);
				ctx.fill();
				// ç”Ÿæ°”çš„çœ‰æ¯›
				ctx.beginPath();
				ctx.strokeStyle = '#000';
				ctx.lineWidth = 2;
				ctx.moveTo(rightPlayer.x - 12, rightPlayer.y - 16);
				ctx.lineTo(rightPlayer.x - 6, rightPlayer.y - 12);
				ctx.moveTo(rightPlayer.x + 12, rightPlayer.y - 16);
				ctx.lineTo(rightPlayer.x + 6, rightPlayer.y - 12);
				ctx.stroke();

				// ç»˜åˆ¶å­å¼¹
				for (let b of bullets) {
					ctx.beginPath();
					ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
					ctx.fillStyle = b.side === 'left' ? '#3b82f6' : '#dc2626';
					ctx.shadowBlur = 15;
					ctx.fill();
					// å­å¼¹å°¾è¿¹
					ctx.beginPath();
					ctx.arc(b.x - b.vx * 0.8, b.y - b.vy * 0.8, b.r * 0.6, 0, Math.PI*2);
					ctx.fillStyle = '#ffffff80';
					ctx.fill();
				}
				ctx.shadowBlur = 0;

				// ç»˜åˆ¶å†·å´æŒ‡ç¤ºå™¨
				if (leftCooldown > 0) {
					ctx.fillStyle = '#ffffff50';
					ctx.font = 'bold 14px sans-serif';
					ctx.fillText('â³', leftPlayer.x - 30, leftPlayer.y - 40);
				}
				if (rightCooldown > 0) {
					ctx.fillStyle = '#ffffff50';
					ctx.font = 'bold 14px sans-serif';
					ctx.fillText('â³', rightPlayer.x + 20, rightPlayer.y - 40);
				}
			}

			// æ¸¸æˆå¾ªç¯
			function gameLoop() {
				updatePlayers();
				updateBullets();
				draw();
				requestAnimationFrame(gameLoop);
			}
			gameLoop();

			// é˜»æ­¢é¡µé¢æ»šåŠ¨
			document.body.addEventListener('touchmove', (e) => {
				if (e.target.closest('button')) {
					e.preventDefault();
				}
			}, { passive: false });
		})();
	</script>
</body>
</html>