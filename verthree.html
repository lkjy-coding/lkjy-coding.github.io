<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>OJè¿ç»´æ¨¡æ‹Ÿå™¨ Â· 3.0 å‡ºé¢˜+å°æ¸¸æˆ</title>
	<style>
		* {
			box-sizing: border-box;
			font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
		}
		body {
			background: linear-gradient(145deg, #1a2639 0%, #0f172a 100%);
			margin: 0;
			min-height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			padding: 16px;
		}
		.game-container {
			max-width: 1400px;
			width: 100%;
			background: rgba(255,255,255,0.07);
			backdrop-filter: blur(12px);
			-webkit-backdrop-filter: blur(12px);
			border-radius: 48px;
			box-shadow: 0 30px 50px rgba(0,0,0,0.7);
			padding: 28px 32px;
			border: 1px solid rgba(255,255,255,0.1);
			color: #e2e8f0;
		}
		h1 {
			font-size: 2.5rem;
			font-weight: 700;
			margin: 0 0 10px 0;
			background: linear-gradient(135deg, #a5b4fc, #c084fc);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			letter-spacing: -0.5px;
			display: flex;
			align-items: center;
			gap: 15px;
		}
		.subtitle {
			color: #94a3b8;
			margin-bottom: 25px;
			border-left: 4px solid #3b82f6;
			padding-left: 18px;
			font-size: 1.1rem;
			background: rgba(0,0,0,0.2);
			border-radius: 0 20px 20px 0;
			line-height: 1.5;
		}
		.stats-grid {
			display: grid;
			grid-template-columns: repeat(7, 1fr);
			gap: 12px;
			margin-bottom: 30px;
		}
		.stat-card {
			background: rgba(15, 23, 42, 0.8);
			border-radius: 24px;
			padding: 18px 12px;
			border: 1px solid rgba(255,255,255,0.1);
			box-shadow: 0 8px 16px rgba(0,0,0,0.4);
			text-align: center;
		}
		.stat-label {
			font-size: 0.8rem;
			text-transform: uppercase;
			letter-spacing: 1px;
			color: #94a3b8;
			margin-bottom: 8px;
		}
		.stat-value {
			font-size: 2.0rem;
			font-weight: 700;
			color: #f1f5f9;
			line-height: 1.2;
		}
		.stat-unit {
			font-size: 0.9rem;
			color: #64748b;
			margin-left: 2px;
		}
		.progress-bar {
			width: 100%;
			height: 8px;
			background: #1e293b;
			border-radius: 10px;
			margin-top: 10px;
			overflow: hidden;
		}
		.progress-fill {
			height: 100%;
			background: linear-gradient(90deg, #3b82f6, #8b5cf6);
			border-radius: 10px;
			width: 0%;
		}
		.action-panel {
			background: rgba(15, 23, 42, 0.6);
			border-radius: 36px;
			padding: 26px 28px;
			margin-bottom: 30px;
			border: 1px solid rgba(255,255,255,0.1);
		}
		.action-row {
			display: flex;
			flex-wrap: wrap;
			gap: 16px;
			margin-bottom: 24px;
			align-items: center;
		}
		.btn {
			background: rgba(255,255,255,0.1);
			border: 1px solid rgba(255,255,255,0.15);
			padding: 14px 28px;
			border-radius: 60px;
			font-size: 1.0rem;
			font-weight: 600;
			color: #f1f5f9;
			cursor: pointer;
			transition: all 0.2s;
			box-shadow: 0 4px 12px rgba(0,0,0,0.3);
			display: inline-flex;
			align-items: center;
			gap: 8px;
		}
		.btn:hover {
			background: rgba(59, 130, 246, 0.8);
			border-color: #3b82f6;
			transform: translateY(-2px);
			box-shadow: 0 12px 24px rgba(37, 99, 235, 0.3);
		}
		.btn.danger:hover {
			background: rgba(239, 68, 68, 0.8);
			border-color: #ef4444;
		}
		.btn.success:hover {
			background: rgba(34, 197, 94, 0.8);
			border-color: #22c55e;
		}
		.btn.warning:hover {
			background: rgba(245, 158, 11, 0.8);
			border-color: #f59e0b;
		}
		.info-text {
			background: rgba(0,0,0,0.3);
			border-radius: 20px;
			padding: 12px 18px;
			font-size: 0.95rem;
			color: #cbd5e1;
			border-left: 4px solid #f59e0b;
		}
		.log-section {
			background: #0f172a;
			border-radius: 28px;
			padding: 22px 26px;
			border: 1px solid #334155;
		}
		.log-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 18px;
			font-weight: 600;
			color: #e2e8f0;
		}
		.log-container {
			max-height: 180px;
			overflow-y: auto;
			font-family: 'JetBrains Mono', monospace;
			font-size: 0.85rem;
			line-height: 1.6;
			color: #a0aec0;
		}
		.log-entry {
			padding: 6px 0;
			border-bottom: 1px solid #1e293b;
		}
		.log-time {
			color: #5f6c84;
			margin-right: 12px;
		}
		.footer {
			margin-top: 28px;
			display: flex;
			flex-wrap: wrap;
			justify-content: space-between;
			align-items: center;
			font-size: 0.9rem;
			color: #7f8ea3;
			border-top: 1px solid #26344b;
			padding-top: 20px;
		}
		.footer a {
			color: #90a4c2;
			text-decoration: none;
			border-bottom: 1px dotted #4b5b73;
		}
		.footer a:hover {
			color: #bbd1f0;
		}
		.credit-line {
			display: flex;
			gap: 25px;
			flex-wrap: wrap;
		}
		.modal {
			display: none;
			position: fixed;
			z-index: 100;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0,0,0,0.7);
			backdrop-filter: blur(5px);
			align-items: center;
			justify-content: center;
		}
		.modal-content {
			background: #1e293b;
			border-radius: 40px;
			padding: 30px 40px;
			max-width: 500px;
			width: 90%;
			border: 2px solid #3b82f6;
			color: white;
			box-shadow: 0 30px 50px black;
		}
		.modal-content h2 {
			margin-top: 0;
			color: #a5b4fc;
		}
		.modal-buttons {
			display: flex;
			gap: 15px;
			justify-content: center;
			margin: 25px 0 10px;
		}
		.game-area {
			text-align: center;
			background: #0f172a;
			border-radius: 30px;
			padding: 20px;
			margin: 15px 0;
		}
		.click-target {
			display: inline-block;
			background: #ef4444;
			color: white;
			font-size: 2rem;
			padding: 20px 40px;
			border-radius: 60px;
			cursor: pointer;
			animation: pulse 1s infinite;
			user-select: none;
		}
		@keyframes pulse {
			0% { transform: scale(1); }
			50% { transform: scale(1.1); background: #f97316; }
			100% { transform: scale(1); }
		}
		#gameTimer, #gameScore {
			font-size: 1.4rem;
			font-weight: bold;
			color: #fbbf24;
		}
	</style>
</head>
<body>
<div class="game-container">
	<h1>
		âš¡ OJè¿ç»´æ¨¡æ‹Ÿå™¨ Â· 3.0
		<span style="font-size: 1.0rem; background: #2d3a4e; padding: 5px 15px; border-radius: 40px; color: #b9c7dc;">è‡ªä¸»å‡ºé¢˜ + å°æ¸¸æˆ</span>
	</h1>
	<div class="subtitle">
		ä½ å°†å›åˆ°2013å¹´ï¼Œæ‰‹æ¡2000å…ƒèµ„é‡‘ï¼Œç›®æ ‡æ˜¯è¿è¥OJç›´åˆ°2026å¹´ä¸å€’é—­ã€‚ç°åœ¨ä½ å¯ä»¥è‡ªå·±å‡ºé¢˜ï¼Œè¿˜èƒ½ç©å°æ¸¸æˆèµšå¤–å¿«ï¼
	</div>

	<!-- ä»ªè¡¨ç›˜ï¼šæ ¸å¿ƒèµ„æºï¼ˆæ–°å¢é¢˜ç›®æ€»æ•°ï¼‰ -->
	<div class="stats-grid">
		<div class="stat-card">
			<div class="stat-label">ğŸ’° èµ„é‡‘</div>
			<div class="stat-value" id="money">2000</div>
			<div class="stat-unit">å…ƒ</div>
		</div>
		<div class="stat-card">
			<div class="stat-label">ğŸ“‹ é¢˜ç›®æ€»æ•°</div>
			<div class="stat-value" id="problems">24</div>
		</div>
		<div class="stat-card">
			<div class="stat-label">ğŸ‘¥ æ´»è·ƒç”¨æˆ·</div>
			<div class="stat-value" id="users">50</div>
		</div>
		<div class="stat-card">
			<div class="stat-label">ğŸ“Š æœåŠ¡å™¨è´Ÿè½½</div>
			<div class="stat-value" id="load">32</div>
			<div class="stat-unit">%</div>
			<div class="progress-bar"><div class="progress-fill" id="loadBar" style="width:32%"></div></div>
		</div>
		<div class="stat-card">
			<div class="stat-label">ğŸ’¾ ç¡¬ç›˜å ç”¨</div>
			<div class="stat-value" id="disk">12</div>
			<div class="stat-unit">GB / <span id="diskTotalDisplay">50</span>GB</div>
			<div class="progress-bar"><div class="progress-fill" id="diskBar" style="width:24%"></div></div>
		</div>
		<div class="stat-card">
			<div class="stat-label">ğŸ“ˆ å£°èª‰</div>
			<div class="stat-value" id="reputation">60</div>
			<div class="stat-unit">%</div>
		</div>
		<div class="stat-card">
			<div class="stat-label">ğŸ“… å½“å‰æ—¶é—´</div>
			<div class="stat-value" id="time">2013.01</div>
			<div class="stat-unit" id="weekUnit">ç¬¬1å‘¨</div>
		</div>
	</div>

	<!-- æ“ä½œé¢æ¿ï¼šæ–°å¢ä¸¤ä¸ªæŒ‰é’® -->
	<div class="action-panel">
		<div class="action-row">
			<button class="btn" id="nextWeekBtn">â© ç‚¹å‡»ä¸‹ä¸€å‘¨</button>
			<button class="btn success" id="compWaterBtn">ğŸ’§ ä¸¾åŠæ°´èµ›</button>
			<button class="btn" id="compGoodBtn">ğŸ† ä¸¾åŠä¼˜è´¨èµ›</button>
			<button class="btn danger" id="donateBtn">ğŸ™ å·å¬å‹Ÿæ</button>
		</div>
		<div class="action-row">
			<button class="btn" id="buyServerBtn">ğŸ–¥ï¸ è´­ä¹°æœåŠ¡å™¨ (500å…ƒ/æ ¸)</button>
			<button class="btn" id="upgradeDiskBtn">â¬†ï¸ æ‰©å®¹ç¡¬ç›˜ (300å…ƒ/10GB)</button>
			<button class="btn" id="researchSchoolBtn">ğŸ“š ç ”å‘/å‡çº§ç½‘æ ¡</button>
			<button class="btn warning" id="addProblemBtn">ğŸ“ è‡ªä¸»å‡ºé¢˜</button>
			<button class="btn warning" id="miniGameBtn">ğŸ® æŒ‘æˆ˜å°æ¸¸æˆ</button>
		</div>
		<div class="info-text" id="eventMessage">
			âš¡ å‡†å¤‡å°±ç»ªï¼Œç‚¹å‡»â€œä¸‹ä¸€å‘¨â€å¼€å§‹è¿è¥ã€‚
		</div>
	</div>

	<!-- ç½‘æ ¡çŠ¶æ€ & å…¶ä»– -->
	<div style="display: flex; gap: 20px; margin-bottom: 20px; background: #1e293b; border-radius: 24px; padding: 15px 20px; flex-wrap: wrap;">
		<div><span style="color:#94a3b8;">ç½‘æ ¡ç­‰çº§:</span> <span id="schoolLevel" style="font-weight:bold;">0</span> <span id="schoolLevelDesc">(æœªç ”å‘)</span></div>
		<div><span style="color:#94a3b8;">æœåŠ¡å™¨æ ¸å¿ƒæ•°:</span> <span id="cores" style="font-weight:bold;">1</span> æ ¸</div>
		<div><span style="color:#94a3b8;">æ€»ç¡¬ç›˜ç©ºé—´:</span> <span id="totalDisk" style="font-weight:bold;">50</span> GB</div>
	</div>

	<!-- äº‹ä»¶æ—¥å¿— -->
	<div class="log-section">
		<div class="log-header">
			<span>ğŸ“‹ è¿è¥æ—¥å¿—</span>
			<button class="btn" id="clearLog" style="padding:6px 16px; background:#2d3a4e;">æ¸…é™¤</button>
		</div>
		<div class="log-container" id="logContainer">
			<div class="log-entry"><span class="log-time">[2013.01]</span> ä½ çš„OJå¼€å¼ äº†ï¼åˆå§‹èµ„é‡‘2000å…ƒï¼Œç”¨æˆ·50äººã€‚</div>
		</div>
	</div>

	<!-- é¡µè„šï¼šè‡´è°¢ä¸é“¾æ¥ -->
	<div class="footer">
		<div class="credit-line">
			<span>ğŸ¯ ç©æ³•æ ¸å¿ƒå‚è€ƒï¼š<a href="https://www.luogu.com.cn/article/dcqcee1r" target="_blank">æ´›è°·æ–‡ç« ã€Šä¸€ä¸ªOJè¿ç»´æ¨¡æ‹Ÿå™¨ã€‹</a></span>
			<span>ğŸ™ åŸåˆ›æ„æƒ³ï¼š<a href="https://chenzheaya.github.io/OnlineJudgeMaintainerSimulator/" target="_blank">chen_zhe é¡¹ç›®</a></span>
			<span>âš¡ å‰ä½œï¼š<a href="https://lkjy-coding.github.io/" target="_blank">lkjy-coding.github.io</a></span>
		</div>
		<div>â³ æ’‘åˆ°2026å¹´ Â· ä½ èƒ½åšåˆ°å—ï¼Ÿ</div>
	</div>
</div>

<!-- å‡ºé¢˜æ¨¡æ€æ¡† -->
<div id="problemModal" class="modal">
	<div class="modal-content">
		<h2>ğŸ“ è‡ªä¸»å‡ºé¢˜</h2>
		<p>é€‰æ‹©é¢˜ç›®éš¾åº¦ï¼Œæ¶ˆè€—ä¸åŒèµ„æºã€‚æ–°é¢˜ä¼šå¸å¼•ç”¨æˆ·ï¼Œä½†å¢åŠ ç¡¬ç›˜å ç”¨ã€‚</p>
		<div class="modal-buttons">
			<button class="btn success" id="problemEasy">ç®€å• (200å…ƒ)</button>
			<button class="btn" id="problemMedium">ä¸­ç­‰ (500å…ƒ)</button>
			<button class="btn danger" id="problemHard">å›°éš¾ (900å…ƒ)</button>
		</div>
		<div style="text-align:center; margin-top:20px;">
			<button class="btn" id="closeProblemModal">å…³é—­</button>
		</div>
	</div>
</div>

<!-- å°æ¸¸æˆæ¨¡æ€æ¡† -->
<div id="gameModal" class="modal">
	<div class="modal-content">
		<h2>ğŸ® å¿«é€Ÿç‚¹å‡»æ•‘æœåŠ¡å™¨</h2>
		<p>10ç§’å†…ç‚¹å‡»ä¸‹æ–¹çš„æ•…éšœå›¾æ ‡ï¼Œæ¯æ¬¡ç‚¹å‡»è·å¾—10å…ƒå¹¶é™ä½è´Ÿè½½ï¼</p>
		<div class="game-area">
			<div id="gameTimer">10</div>
			<div id="gameScore">å¾—åˆ†: 0</div>
			<div id="clickTarget" class="click-target">âš ï¸ æ•…éšœ</div>
		</div>
		<div style="text-align:center;">
			<button class="btn" id="closeGameModal">å…³é—­</button>
		</div>
	</div>
</div>

<script>
	(function() {
		// ---------- åˆå§‹çŠ¶æ€ ----------
		let money = 2000;
		let users = 50;
		let reputation = 60;
		let diskUsed = 12;
		let diskTotal = 50;
		let serverCores = 1;
		let schoolLevel = 0;
		let problems = 24;          // æ–°å¢é¢˜ç›®æ€»æ•°

		let year = 2013;
		let week = 1;
		let baseLoadPerUser = 0.8;
		let logEntries = [];
		let gameOver = false;
		let gameWin = false;

		// æ¸¸æˆç›¸å…³å˜é‡
		let gameActive = false;
		let gameScore = 0;
		let gameTimer = 10;
		let gameInterval = null;

		// ---------- è¾…åŠ©å‡½æ•° ----------
		function formatMoney(value) {
			return Math.round(value);
		}

		function updateUI() {
			if (gameOver) return;
			document.getElementById('money').innerText = formatMoney(money);
			document.getElementById('users').innerText = users;
			document.getElementById('problems').innerText = problems;
			document.getElementById('reputation').innerText = Math.min(100, Math.max(0, Math.round(reputation)));

			let rawLoad = users * baseLoadPerUser * (1.0 / serverCores);
			rawLoad = Math.min(100, Math.max(0, rawLoad));
			document.getElementById('load').innerText = Math.round(rawLoad);
			document.getElementById('loadBar').style.width = rawLoad + '%';

			let diskPercent = (diskUsed / diskTotal) * 100;
			document.getElementById('disk').innerText = diskUsed.toFixed(1);
			document.getElementById('totalDisk').innerText = diskTotal;
			document.getElementById('diskTotalDisplay').innerText = diskTotal;
			document.getElementById('diskBar').style.width = Math.min(100, diskPercent) + '%';

			let timeStr = year + '.' + (week < 10 ? '0' : '') + week;
			document.getElementById('time').innerText = timeStr;
			document.getElementById('weekUnit').innerText = 'ç¬¬' + week + 'å‘¨';

			document.getElementById('schoolLevel').innerText = schoolLevel;
			let levelDesc = '';
			if (schoolLevel === 0) levelDesc = '(æœªç ”å‘)';
			else if (schoolLevel === 1) levelDesc = 'å…¥é—¨è¯¾';
			else if (schoolLevel === 2) levelDesc = 'å†²åˆºç­';
			else if (schoolLevel === 3) levelDesc = 'å›½èµ›ç­';
			document.getElementById('schoolLevelDesc').innerText = levelDesc;
			document.getElementById('cores').innerText = serverCores;

			// æ£€æŸ¥å¤±è´¥æ¡ä»¶
			if (money < 0) {
				gameOver = true;
				addLog('âŒ èµ„é‡‘é“¾æ–­è£‚ï¼ä½ çš„OJå€’é—­äº†ã€‚');
				alert('æ¸¸æˆç»“æŸï¼šèµ„é‡‘è€—å°½ï¼');
			} else if (diskUsed > diskTotal) {
				gameOver = true;
				addLog('âŒ ç¡¬ç›˜å¡æ»¡ï¼ŒæœåŠ¡ä¸­æ–­ï¼OJå…³åœã€‚');
				alert('æ¸¸æˆç»“æŸï¼šç¡¬ç›˜çˆ†æ»¡ï¼');
			} else if (rawLoad >= 100) {
				gameOver = true;
				addLog('ğŸ’¥ æœåŠ¡å™¨è´Ÿè½½è¶…è¿‡100%ï¼ç³»ç»Ÿå´©æºƒã€‚');
				alert('æ¸¸æˆç»“æŸï¼šæœåŠ¡å™¨ç‚¸äº†ï¼');
			} else if (reputation <= 0) {
				gameOver = true;
				addLog('ğŸ“‰ å£°èª‰å½’é›¶ï¼Œç”¨æˆ·çº·çº·ç¦»å»ã€‚OJå€’é—­ã€‚');
				alert('æ¸¸æˆç»“æŸï¼šå£°èª‰æ‰«åœ°ï¼');
			} else if (year >= 2026 && week >= 1) {
				if (!gameWin) {
					gameWin = true;
					gameOver = true;
					addLog('ğŸ‰ æ­å–œï¼ä½ æˆåŠŸè¿è¥OJè‡³2026å¹´ï¼äº†ä¸èµ·çš„ç«™é•¿ï¼');
					alert('ğŸ‰ èƒœåˆ©ï¼ä½ åšæŒåˆ°äº†2026å¹´ï¼å¿«å»è¯„è®ºåŒºæ™’åˆ†å§ã€‚');
				}
			}
		}

		function addLog(msg) {
			let timeStr = year + '.' + (week < 10 ? '0' : '') + week;
			logEntries.push({ time: timeStr, msg });
			if (logEntries.length > 30) logEntries.shift();
			renderLog();
		}

		function renderLog() {
			const container = document.getElementById('logContainer');
			container.innerHTML = '';
			logEntries.slice().reverse().forEach(entry => {
				const div = document.createElement('div');
				div.className = 'log-entry';
				div.innerHTML = `<span class="log-time">[${entry.time}]</span> ${entry.msg}`;
				container.appendChild(div);
			});
		}

		function randomEvent() {
			if (gameOver) return;
			let r = Math.random();
			if (r < 0.15) {
				let gain = Math.floor(Math.random() * 80) + 30;
				money += gain;
				addLog(`âœ¨ ç¤¾åŒºæèµ ï¼šè·å¾— ${gain} å…ƒèµåŠ©ã€‚`);
			} else if (r < 0.25) {
				let loss = Math.floor(Math.random() * 100) + 50;
				money -= loss;
				addLog(`âš ï¸ æœåŠ¡å™¨æ•…éšœï¼šç»´ä¿®èŠ±è´¹ ${loss} å…ƒã€‚`);
				if (money < 0) addLog('âš ï¸ èµ„é‡‘ä¸è¶³ï¼Œå±é™©ï¼');
			} else if (r < 0.35) {
				let change = Math.floor(Math.random() * 15) - 3;
				users = Math.max(10, users + change);
				addLog(`ğŸ‘¥ ç”¨æˆ·æ•°å˜åŠ¨ï¼š${change>0?'+'+change:change} äºº`);
			}
			let diskIncrease = (users * 0.02) + (schoolLevel * 0.5) + (problems * 0.01); // é¢˜ç›®ä¹Ÿå ç©ºé—´
			diskUsed = Math.min(diskTotal, diskUsed + diskIncrease);
			if (diskIncrease > 0) {
				addLog(`ğŸ’¾ æ•°æ®å¢é•¿ï¼š+${diskIncrease.toFixed(2)} GB`);
			}

			if (reputation < 50) {
				reputation += 1.5;
				if (reputation > 50) reputation = 50;
			} else if (reputation > 70) {
				reputation -= 0.5;
			}
		}

		// ä¸‹ä¸€å‘¨
		function nextWeek() {
			if (gameOver) return;

			let serverCost = serverCores * 120;
			money -= serverCost;
			addLog(`ğŸ’° æœåŠ¡å™¨ç»´æŠ¤è´¹ï¼š-${serverCost}å…ƒ`);

			if (schoolLevel > 0) {
				let income = 0;
				if (schoolLevel === 1) income = 80 + Math.floor(users * 0.2);
				else if (schoolLevel === 2) income = 200 + Math.floor(users * 0.5);
				else if (schoolLevel === 3) income = 500 + Math.floor(users * 1.2);
				money += income;
				addLog(`ğŸ“š ç½‘æ ¡æ”¶å…¥ï¼š+${income}å…ƒ (Lv.${schoolLevel})`);
			}

			randomEvent();

			let userGrowth = Math.floor( (reputation / 100) * 8 ) + 2;
			users = Math.max(10, users + userGrowth);

			week++;
			if (week > 52) {
				week = 1;
				year++;
				addLog(`ğŸ‰ æ–°å¹´å¿«ä¹ï¼ç°åœ¨æ˜¯ ${year} å¹´ã€‚`);
			}

			if (diskUsed > diskTotal) {
				diskUsed = diskTotal;
				gameOver = true;
				addLog('âŒ ç¡¬ç›˜å¡æ»¡ï¼ŒæœåŠ¡ä¸­æ–­ï¼OJå…³åœã€‚');
				alert('æ¸¸æˆç»“æŸï¼šç¡¬ç›˜çˆ†æ»¡ï¼');
			}

			updateUI();
			if (!gameOver) {
				document.getElementById('eventMessage').innerText = 'ğŸ“¢ æ–°çš„ä¸€å‘¨å¼€å§‹äº†ã€‚';
			}
		}

		// ---------- è‡ªä¸»å‡ºé¢˜ ----------
		function addProblem( difficulty, cost, repEffect, userEffect, diskEffect ) {
			if (gameOver) return;
			if (money < cost) {
				addLog('âŒ èµ„é‡‘ä¸è¶³ï¼Œæ— æ³•å‡ºé¢˜');
				return;
			}
			money -= cost;
			problems++;
			reputation = Math.min(100, Math.max(0, reputation + repEffect));
			users = Math.max(10, users + userEffect);
			diskUsed = Math.min(diskTotal, diskUsed + diskEffect);
			addLog(`ğŸ“ å‡ºé¢˜æˆåŠŸï¼éš¾åº¦: ${difficulty}ï¼Œé¢˜ç›®æ•°+1ï¼Œå£°èª‰${repEffect>0?'+'+repEffect:repEffect}ï¼Œç”¨æˆ·+${userEffect}ï¼Œç¡¬ç›˜+${diskEffect}GB`);
			updateUI();
		}

		// ---------- å°æ¸¸æˆ ----------
		function startMiniGame() {
			if (gameOver) return;
			if (gameActive) return;
			document.getElementById('gameModal').style.display = 'flex';
			gameActive = true;
			gameScore = 0;
			gameTimer = 10;
			document.getElementById('gameScore').innerText = 'å¾—åˆ†: 0';
			document.getElementById('gameTimer').innerText = gameTimer;
			document.getElementById('clickTarget').style.pointerEvents = 'auto';

			if (gameInterval) clearInterval(gameInterval);
			gameInterval = setInterval(() => {
				gameTimer--;
				document.getElementById('gameTimer').innerText = gameTimer;
				if (gameTimer <= 0) {
					endMiniGame();
				}
			}, 1000);
		}

		function endMiniGame() {
			clearInterval(gameInterval);
			gameActive = false;
			document.getElementById('clickTarget').style.pointerEvents = 'none';
			// å¥–åŠ±ï¼šæ¯ç‚¹å¾—10å…ƒï¼Œå¹¶å‡å°‘è´Ÿè½½
			let reward = gameScore * 10;
			money += reward;
			// æ¯ç‚¹è¿˜é™ä½è´Ÿè½½ï¼ˆæ¨¡æ‹Ÿå¿«é€Ÿä¿®å¤ï¼‰
			let loadReduction = gameScore * 2;
			// è´Ÿè½½è®¡ç®—æ²¡æ³•ç›´æ¥å‡ï¼Œæˆ‘ä»¬é€šè¿‡å¢åŠ ä¸´æ—¶â€œå¤„ç†èƒ½åŠ›â€æ¥ä½“ç°ï¼Œè¿™é‡Œç®€å•åŠ é’±å¹¶å‡å°‘ä¸€ç‚¹ç¡¬ç›˜ï¼Ÿæˆ–è€…ç›´æ¥åŠ é’±åŠ å£°èª‰
			reputation = Math.min(100, reputation + Math.floor(gameScore / 2));
			addLog(`ğŸ® å°æ¸¸æˆç»“æŸï¼ç‚¹å‡»${gameScore}æ¬¡ï¼Œè·å¾—${reward}å…ƒï¼Œå£°èª‰+${Math.floor(gameScore/2)}`);
			updateUI();
			// ä¸å…³é—­æ¨¡æ€æ¡†ï¼Œä½†ç”¨æˆ·å¯æ‰‹åŠ¨å…³é—­
		}

		// ---------- æŒ‰é’®äº‹ä»¶ç»‘å®š ----------
		document.addEventListener('DOMContentLoaded', function() {
			updateUI();
			addLog('æ¸¸æˆå¼€å§‹ï¼ç›®æ ‡ï¼šåšæŒåˆ°2026å¹´ã€‚');

			document.getElementById('nextWeekBtn').addEventListener('click', nextWeek);
			document.getElementById('compWaterBtn').addEventListener('click', function() {
				if (gameOver) return;
				if (reputation < 10) { addLog('âŒ å£°èª‰å¤ªä½'); return; }
				if (money < 80) { addLog('âŒ èµ„é‡‘ä¸è¶³'); return; }
				money -= 80;
				reputation -= 12;
				let userGain = Math.floor(Math.random() * 30) + 20;
				users += userGain;
				let moneyGain = Math.floor(Math.random() * 150) + 100;
				money += moneyGain;
				addLog(`ğŸ’§ æ°´èµ›ï¼š+${userGain}ç”¨æˆ·, +${moneyGain}å…ƒ, å£°èª‰-12`);
				updateUI();
			});
			document.getElementById('compGoodBtn').addEventListener('click', function() {
				if (gameOver) return;
				if (money < 350) { addLog('âŒ èµ„é‡‘ä¸è¶³'); return; }
				money -= 350;
				reputation += 20;
				let userGain = Math.floor(Math.random() * 20) + 30;
				users += userGain;
				addLog(`ğŸ† ä¼˜è´¨èµ›ï¼š+${userGain}ç”¨æˆ·, å£°èª‰+20`);
				updateUI();
			});
			document.getElementById('donateBtn').addEventListener('click', function() {
				if (gameOver) return;
				if (reputation < 15) { addLog('âŒ å£°èª‰å¤ªä½'); return; }
				let donate = Math.floor(reputation * 8) + 50;
				money += donate;
				reputation = Math.max(0, reputation - 30);
				addLog(`ğŸ™ å‹Ÿæï¼šè·å¾— ${donate} å…ƒ, å£°èª‰-30`);
				updateUI();
			});
			document.getElementById('buyServerBtn').addEventListener('click', function() {
				if (gameOver) return;
				if (money < 500) { addLog('âŒ èµ„é‡‘ä¸è¶³'); return; }
				money -= 500;
				serverCores++;
				addLog(`ğŸ–¥ï¸ è´­ä¹°æ ¸å¿ƒï¼Œç°åœ¨å…± ${serverCores} æ ¸`);
				updateUI();
			});
			document.getElementById('upgradeDiskBtn').addEventListener('click', function() {
				if (gameOver) return;
				if (money < 300) { addLog('âŒ èµ„é‡‘ä¸è¶³'); return; }
				money -= 300;
				diskTotal += 10;
				addLog(`â¬†ï¸ ç¡¬ç›˜æ‰©å®¹10GBï¼Œæ€»å®¹é‡ ${diskTotal}GB`);
				updateUI();
			});
			document.getElementById('researchSchoolBtn').addEventListener('click', function() {
				if (gameOver) return;
				if (schoolLevel >= 3) { addLog('ğŸ“š å·²æœ€é«˜çº§'); return; }
				let cost = [600, 1000, 2000][schoolLevel];
				if (money < cost) { addLog('âŒ èµ„é‡‘ä¸è¶³'); return; }
				money -= cost;
				schoolLevel++;
				addLog(`ğŸ“š ç½‘æ ¡å‡çº§è‡³ Lv.${schoolLevel}`);
				updateUI();
			});

			// æ–°å¢å‡ºé¢˜åŠŸèƒ½
			document.getElementById('addProblemBtn').addEventListener('click', function() {
				if (gameOver) return;
				document.getElementById('problemModal').style.display = 'flex';
			});
			document.getElementById('problemEasy').addEventListener('click', function() {
				addProblem('ç®€å•', 200, 2, 5, 0.5);
				document.getElementById('problemModal').style.display = 'none';
			});
			document.getElementById('problemMedium').addEventListener('click', function() {
				addProblem('ä¸­ç­‰', 500, 5, 12, 1.2);
				document.getElementById('problemModal').style.display = 'none';
			});
			document.getElementById('problemHard').addEventListener('click', function() {
				addProblem('å›°éš¾', 900, 10, 20, 2.5);
				document.getElementById('problemModal').style.display = 'none';
			});
			document.getElementById('closeProblemModal').addEventListener('click', function() {
				document.getElementById('problemModal').style.display = 'none';
			});

			// å°æ¸¸æˆ
			document.getElementById('miniGameBtn').addEventListener('click', function() {
				if (gameOver) return;
				startMiniGame();
			});
			document.getElementById('clickTarget').addEventListener('click', function() {
				if (gameActive && gameTimer > 0) {
					gameScore++;
					document.getElementById('gameScore').innerText = 'å¾—åˆ†: ' + gameScore;
				}
			});
			document.getElementById('closeGameModal').addEventListener('click', function() {
				if (gameActive) {
					clearInterval(gameInterval);
					gameActive = false;
				}
				document.getElementById('gameModal').style.display = 'none';
			});

			document.getElementById('clearLog').addEventListener('click', function() {
				logEntries = [];
				renderLog();
			});
		});
	})();
</script>
</body>
</html>