<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>åŒäººç©ºæˆ˜ Â· åå­—æ“ä½œ</title>
	<style>
		* {
			box-sizing: border-box;
			user-select: none;
			-webkit-tap-highlight-color: transparent;
		}
		body {
			margin: 0;
			min-height: 100vh;
			background: linear-gradient(145deg, #0b1c2f, #1a2f42);
			display: flex;
			justify-content: center;
			align-items: center;
			font-family: 'Segoe UI', Roboto, sans-serif;
			padding: 10px;
			touch-action: pan-y pinch-zoom;
		}
		.game-container {
			width: 100%;
			max-width: 500px;
			background: #1e3a5f;
			border-radius: 40px;
			padding: 20px;
			box-shadow: 0 20px 35px #00000080;
			border: 2px solid #4c7aa2;
		}
		.header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			color: #e6f0ff;
			font-size: 1.2rem;
			font-weight: 700;
			margin-bottom: 15px;
			padding: 0 10px;
		}
		.score-board {
			background: #0f2a40;
			padding: 8px 20px;
			border-radius: 40px;
			display: flex;
			gap: 30px;
		}
		.score-left, .score-right {
			display: flex;
			align-items: center;
			gap: 5px;
		}
		.score-left span, .score-right span {
			font-size: 1.5rem;
			color: #ffb347;
		}
		.map-name {
			background: #0f2a40;
			padding: 5px 15px;
			border-radius: 30px;
			color: #a5d8ff;
			font-size: 0.9rem;
		}
		canvas {
			display: block;
			margin: 0 auto;
			width: 100%;
			aspect-ratio: 1/1;
			border-radius: 30px;
			background: #87CEEB;
			box-shadow: inset 0 0 20px #00000055, 0 10px 15px black;
			border: 4px solid #5f8db0;
			touch-action: none;
		}
		.controls-row {
			display: flex;
			justify-content: space-between;
			margin-top: 20px;
			gap: 10px;
		}
		.player-controls {
			flex: 1;
			display: flex;
			flex-direction: column;
			align-items: center;
			background: #0f2a40;
			border-radius: 30px;
			padding: 15px 10px;
			border: 2px solid #3a6792;
		}
		.player-label {
			color: #d7ecff;
			font-weight: bold;
			margin-bottom: 12px;
			font-size: 1.1rem;
		}
		.player-label.left {
			color: #3b82f6;
		}
		.player-label.right {
			color: #dc2626;
		}
		
		/* åå­—æ“ä½œå¸ƒå±€ */
		.cross-grid {
			display: grid;
			grid-template-columns: 1fr 1fr 1fr;
			gap: 8px;
			width: 100%;
			margin-bottom: 8px;
		}
		.cross-center {
			grid-column: 2;
			grid-row: 2;
		}
		.cross-up {
			grid-column: 2;
			grid-row: 1;
		}
		.cross-down {
			grid-column: 2;
			grid-row: 3;
		}
		.cross-left {
			grid-column: 1;
			grid-row: 2;
		}
		.cross-right {
			grid-column: 3;
			grid-row: 2;
		}
		
		.ctrl-btn {
			background: #2d4b6e;
			border: none;
			color: white;
			font-size: 1.8rem;
			font-weight: bold;
			aspect-ratio: 1/1;
			border-radius: 20px;
			box-shadow: 0 5px 0 #0e2637;
			transition: 0.05s;
			display: flex;
			align-items: center;
			justify-content: center;
			touch-action: manipulation;
			cursor: pointer;
			-webkit-tap-highlight-color: transparent;
		}
		.ctrl-btn:active {
			transform: translateY(4px);
			box-shadow: 0 1px 0 #0e2637;
		}
		.ctrl-btn.left-color {
			background: #3b82f6;
		}
		.ctrl-btn.right-color {
			background: #dc2626;
		}
		.fire-btn {
			background: #ffb347;
			color: #1e2f47;
			font-size: 1.2rem;
			padding: 12px 0;
			width: 100%;
			aspect-ratio: auto;
			border-radius: 30px;
			margin-top: 5px;
			box-shadow: 0 5px 0 #b16400;
		}
		.victory-message {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: rgba(0,0,0,0.9);
			color: gold;
			font-size: 3rem;
			font-weight: bold;
			padding: 30px 50px;
			border-radius: 60px;
			border: 4px solid gold;
			z-index: 1000;
			display: none;
			text-align: center;
			backdrop-filter: blur(10px);
		}
		.restart-btn {
			background: #ffb347;
			border: none;
			color: #1e2f47;
			font-size: 1.2rem;
			padding: 10px 30px;
			border-radius: 40px;
			margin-top: 10px;
			font-weight: bold;
			cursor: pointer;
		}
		.footer {
			text-align: center;
			margin-top: 15px;
			color: #8aa9c9;
			font-size: 0.9rem;
		}
	</style>
</head>
<body>
	<div class="victory-message" id="victoryMessage">
		ğŸ† çº¢æ–¹èƒœåˆ© ğŸ†
		<div><button class="restart-btn" onclick="location.reload()">å†ç©ä¸€å±€</button></div>
	</div>

	<div class="game-container">
		<div class="header">
			<span>âš¡ åŒäººç©ºæˆ˜ Â· åå­—æ“ä½œ</span>
			<div class="score-board">
				<div class="score-left">ğŸ”µ <span id="scoreLeft">0</span></div>
				<div class="score-right">ğŸ”´ <span id="scoreRight">0</span></div>
			</div>
		</div>
		<div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
			<div class="map-name" id="mapName">ğŸï¸ åˆå§‹æˆ˜åœº</div>
			<div class="map-name">ğŸ¯ å…ˆå¾—5åˆ†è·èƒœ</div>
		</div>

		<canvas id="gameCanvas" width="400" height="400"></canvas>

		<!-- åŒäººæ§åˆ¶åŒºåŸŸ - åå­—å¸ƒå±€ -->
		<div class="controls-row">
			<!-- å·¦ä¾§ç©å®¶ (è“è‰²) - åå­—æ“ä½œ -->
			<div class="player-controls">
				<div class="player-label left">ğŸ‘ˆ è“æ–¹</div>
				<div class="cross-grid">
					<div class="cross-up">
						<button class="ctrl-btn left-color" id="leftUp">â¬†ï¸</button>
					</div>
					<div class="cross-left">
						<button class="ctrl-btn left-color" id="leftLeft">â¬…ï¸</button>
					</div>
					<div class="cross-center">
						<button class="ctrl-btn left-color fire-btn" id="leftFire">ğŸ”¥</button>
					</div>
					<div class="cross-right">
						<button class="ctrl-btn left-color" id="leftRight">â¡ï¸</button>
					</div>
					<div class="cross-down">
						<button class="ctrl-btn left-color" id="leftDown">â¬‡ï¸</button>
					</div>
				</div>
				<div style="margin-top: 5px; color: #a5d8ff; font-size: 0.8rem;">ä¸­å¤®å¼€ç«</div>
			</div>

			<!-- å³ä¾§ç©å®¶ (çº¢è‰²) - åå­—æ“ä½œ -->
			<div class="player-controls">
				<div class="player-label right">ğŸ‘‰ çº¢æ–¹</div>
				<div class="cross-grid">
					<div class="cross-up">
						<button class="ctrl-btn right-color" id="rightUp">â¬†ï¸</button>
					</div>
					<div class="cross-left">
						<button class="ctrl-btn right-color" id="rightLeft">â¬…ï¸</button>
					</div>
					<div class="cross-center">
						<button class="ctrl-btn right-color fire-btn" id="rightFire">ğŸ”¥</button>
					</div>
					<div class="cross-right">
						<button class="ctrl-btn right-color" id="rightRight">â¡ï¸</button>
					</div>
					<div class="cross-down">
						<button class="ctrl-btn right-color" id="rightDown">â¬‡ï¸</button>
					</div>
				</div>
				<div style="margin-top: 5px; color: #ffa5a5; font-size: 0.8rem;">ä¸­å¤®å¼€ç«</div>
			</div>
		</div>
		<div class="footer">
			å‡»ä¸­å¯¹æ–¹åˆ‡æ¢æˆ˜åœºï¼å…ˆå¾—5åˆ†è·èƒœ
		</div>
	</div>

	<script>
		(function() {
			const canvas = document.getElementById('gameCanvas');
			const ctx = canvas.getContext('2d');
			const victoryMsg = document.getElementById('victoryMessage');
			const mapNameEl = document.getElementById('mapName');

			// æ¸¸æˆé…ç½®
			const config = {
				playerRadius: 16,
				bulletRadius: 5,
				playerSpeed: 3.5,
				bulletSpeed: 5,
				fireCooldown: 15,
				winScore: 5
			};

			// ç©å®¶åˆå§‹ä½ç½®
			let leftPlayer = { x: 80, y: 200, r: config.playerRadius };
			let rightPlayer = { x: 320, y: 200, r: config.playerRadius };

			// å­å¼¹æ•°ç»„
			let bullets = [];

			// åˆ†æ•° - ä¿®æ­£é€»è¾‘ï¼šè“æ–¹å‡»ä¸­çº¢æ–¹è“æ–¹å¾—åˆ†ï¼Œçº¢æ–¹å‡»ä¸­è“æ–¹çº¢æ–¹å¾—åˆ†
			let leftScore = 0;  // è“æ–¹å¾—åˆ†
			let rightScore = 0; // çº¢æ–¹å¾—åˆ†

			// å†·å´
			let leftCooldown = 0;
			let rightCooldown = 0;

			// ç§»åŠ¨çŠ¶æ€
			const leftMove = { up: false, down: false, left: false, right: false };
			const rightMove = { up: false, down: false, left: false, right: false };

			// å½“å‰åœ°å›¾ç´¢å¼•å’Œéšœç¢ç‰©
			let currentMapIndex = 0;
			let obstacles = [];

			// åœ°å›¾åç§°åˆ—è¡¨
			const mapNames = [
				'ğŸï¸ çƒ­å¸¦å²›å±¿', 'ğŸœï¸ æ²™æ¼ é—è¿¹', 'â„ï¸ å†°å°é›ªåŸ', 'ğŸŒ‹ ç«å±±å³¡è°·', 
				'ğŸ™ï¸ åŸå¸‚åºŸå¢Ÿ', 'ğŸŒ² ç¥ç§˜æ£®æ—', 'ğŸª å¤–æ˜ŸåŸºåœ°', 'â›©ï¸ å¤ä»£ç¥åº™',
				'ğŸš¢ åºŸå¼ƒèˆ¹å', 'ğŸ¯ å¿è€…è¦å¡'
			];

			// ç”Ÿæˆéšæœºåœ°å›¾
			function generateRandomMap() {
				currentMapIndex = Math.floor(Math.random() * mapNames.length);
				mapNameEl.innerText = mapNames[currentMapIndex];
				
				obstacles = [];
				const numObstacles = 3 + Math.floor(Math.random() * 4); // 3-6ä¸ªéšœç¢ç‰©
				
				for (let i = 0; i < numObstacles; i++) {
					let type = Math.floor(Math.random() * 3); // 0: åœ†å½¢, 1: çŸ©å½¢, 2: åå­—
					let x = 100 + Math.random() * 200;
					let y = 100 + Math.random() * 200;
					
					// ç¡®ä¿ä¸é®æŒ¡å‡ºç”Ÿç‚¹
					if (Math.hypot(x - 80, y - 200) < 50 || Math.hypot(x - 320, y - 200) < 50) {
						continue;
					}
					
					obstacles.push({
						type: type,
						x: x,
						y: y,
						radius: type === 0 ? 20 + Math.random() * 15 : 0,
						width: type === 1 ? 30 + Math.random() * 30 : 0,
						height: type === 1 ? 30 + Math.random() * 30 : 0,
						rotation: Math.random() * Math.PI
					});
				}
			}

			// åˆå§‹åŒ–åœ°å›¾
			generateRandomMap();

			// åˆ†æ•°æ˜¾ç¤º
			const scoreLeftEl = document.getElementById('scoreLeft');
			const scoreRightEl = document.getElementById('scoreRight');

			// è§¦æ‘¸ç»‘å®š
			function bindButton(btnId, playerMove, dir) {
				const btn = document.getElementById(btnId);
				if (!btn) return;
				
				btn.addEventListener('touchstart', (e) => {
					e.preventDefault();
					playerMove[dir] = true;
				});
				btn.addEventListener('touchend', (e) => {
					e.preventDefault();
					playerMove[dir] = false;
				});
				btn.addEventListener('touchcancel', (e) => {
					e.preventDefault();
					playerMove[dir] = false;
				});
				btn.addEventListener('mousedown', (e) => {
					e.preventDefault();
					playerMove[dir] = true;
				});
				btn.addEventListener('mouseup', (e) => {
					e.preventDefault();
					playerMove[dir] = false;
				});
				btn.addEventListener('mouseleave', (e) => {
					playerMove[dir] = false;
				});
			}

			bindButton('leftUp', leftMove, 'up');
			bindButton('leftDown', leftMove, 'down');
			bindButton('leftLeft', leftMove, 'left');
			bindButton('leftRight', leftMove, 'right');
			bindButton('rightUp', rightMove, 'up');
			bindButton('rightDown', rightMove, 'down');
			bindButton('rightLeft', rightMove, 'left');
			bindButton('rightRight', rightMove, 'right');

			// å¼€ç«
			document.getElementById('leftFire').addEventListener('touchstart', (e) => {
				e.preventDefault();
				if (leftCooldown <= 0) fireBullet('left');
			});
			document.getElementById('leftFire').addEventListener('mousedown', (e) => {
				e.preventDefault();
				if (leftCooldown <= 0) fireBullet('left');
			});
			document.getElementById('rightFire').addEventListener('touchstart', (e) => {
				e.preventDefault();
				if (rightCooldown <= 0) fireBullet('right');
			});
			document.getElementById('rightFire').addEventListener('mousedown', (e) => {
				e.preventDefault();
				if (rightCooldown <= 0) fireBullet('right');
			});

			function fireBullet(side) {
				if (side === 'left') {
					bullets.push({
						x: leftPlayer.x + 15,
						y: leftPlayer.y,
						vx: config.bulletSpeed,
						vy: 0,
						side: 'left',
						r: config.bulletRadius
					});
					leftCooldown = config.fireCooldown;
				} else {
					bullets.push({
						x: rightPlayer.x - 15,
						y: rightPlayer.y,
						vx: -config.bulletSpeed,
						vy: 0,
						side: 'right',
						r: config.bulletRadius
					});
					rightCooldown = config.fireCooldown;
				}
			}

			// æ£€æŸ¥ç¢°æ’ï¼ˆç©å®¶ vs éšœç¢ç‰©ï¼‰
			function checkPlayerObstacleCollision(player) {
				for (let obs of obstacles) {
					if (obs.type === 0) { // åœ†å½¢éšœç¢
						let dx = player.x - obs.x;
						let dy = player.y - obs.y;
						let dist = Math.sqrt(dx*dx + dy*dy);
						if (dist < player.r + obs.radius) {
							return true;
						}
					} else if (obs.type === 1) { // çŸ©å½¢éšœç¢
						// ç®€å•çŸ©å½¢ç¢°æ’æ£€æµ‹
						let halfW = obs.width/2;
						let halfH = obs.height/2;
						let closestX = Math.max(obs.x - halfW, Math.min(player.x, obs.x + halfW));
						let closestY = Math.max(obs.y - halfH, Math.min(player.y, obs.y + halfH));
						let dx = player.x - closestX;
						let dy = player.y - closestY;
						let dist = Math.sqrt(dx*dx + dy*dy);
						if (dist < player.r) {
							return true;
						}
					}
				}
				return false;
			}

			// æ›´æ–°ç©å®¶ä½ç½®ï¼ˆå¸¦éšœç¢ç‰©ç¢°æ’ï¼‰
			function updatePlayers() {
				let oldLeftX = leftPlayer.x, oldLeftY = leftPlayer.y;
				let oldRightX = rightPlayer.x, oldRightY = rightPlayer.y;

				// å·¦ç©å®¶ç§»åŠ¨
				if (leftMove.up) leftPlayer.y -= config.playerSpeed;
				if (leftMove.down) leftPlayer.y += config.playerSpeed;
				if (leftMove.left) leftPlayer.x -= config.playerSpeed;
				if (leftMove.right) leftPlayer.x += config.playerSpeed;

				// è¾¹ç•Œé™åˆ¶
				leftPlayer.x = Math.max(leftPlayer.r, Math.min(canvas.width/2 - 10, leftPlayer.x));
				leftPlayer.y = Math.max(leftPlayer.r, Math.min(canvas.height - leftPlayer.r, leftPlayer.y));

				// éšœç¢ç‰©ç¢°æ’å›é€€
				if (checkPlayerObstacleCollision(leftPlayer)) {
					leftPlayer.x = oldLeftX;
					leftPlayer.y = oldLeftY;
				}

				// å³ç©å®¶ç§»åŠ¨
				if (rightMove.up) rightPlayer.y -= config.playerSpeed;
				if (rightMove.down) rightPlayer.y += config.playerSpeed;
				if (rightMove.left) rightPlayer.x -= config.playerSpeed;
				if (rightMove.right) rightPlayer.x += config.playerSpeed;

				rightPlayer.x = Math.max(canvas.width/2 + 10, Math.min(canvas.width - rightPlayer.r, rightPlayer.x));
				rightPlayer.y = Math.max(rightPlayer.r, Math.min(canvas.height - rightPlayer.r, rightPlayer.y));

				if (checkPlayerObstacleCollision(rightPlayer)) {
					rightPlayer.x = oldRightX;
					rightPlayer.y = oldRightY;
				}
			}

			// æ›´æ–°å­å¼¹ï¼ˆå¸¦éšœç¢ç‰©ç¢°æ’ï¼‰
			function updateBullets() {
				for (let i = bullets.length - 1; i >= 0; i--) {
					const b = bullets[i];
					let newX = b.x + b.vx;
					let newY = b.y + b.vy;

					// éšœç¢ç‰©ç¢°æ’æ£€æµ‹
					let bulletCollided = false;
					for (let obs of obstacles) {
						if (obs.type === 0) { // åœ†å½¢
							let dx = newX - obs.x;
							let dy = newY - obs.y;
							let dist = Math.sqrt(dx*dx + dy*dy);
							if (dist < b.r + obs.radius) {
								bulletCollided = true;
								break;
							}
						} else if (obs.type === 1) { // çŸ©å½¢
							let halfW = obs.width/2;
							let halfH = obs.height/2;
							let closestX = Math.max(obs.x - halfW, Math.min(newX, obs.x + halfW));
							let closestY = Math.max(obs.y - halfH, Math.min(newY, obs.y + halfH));
							let dx = newX - closestX;
							let dy = newY - closestY;
							let dist = Math.sqrt(dx*dx + dy*dy);
							if (dist < b.r) {
								bulletCollided = true;
								break;
							}
						}
					}

					if (bulletCollided) {
						bullets.splice(i, 1);
						continue;
					}

					b.x = newX;
					b.y = newY;

					// è¾¹ç•Œç§»é™¤
					if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
						bullets.splice(i, 1);
						continue;
					}

					// ä¿®æ­£åˆ†æ•°é€»è¾‘ï¼šè“æ–¹å­å¼¹å‡»ä¸­çº¢æ–¹ â†’ è“æ–¹å¾—åˆ†
					if (b.side === 'left') {
						let dx = b.x - rightPlayer.x;
						let dy = b.y - rightPlayer.y;
						let dist = Math.sqrt(dx*dx + dy*dy);
						if (dist < b.r + rightPlayer.r) {
							// è“æ–¹å‡»ä¸­çº¢æ–¹ï¼Œè“æ–¹å¾—åˆ†
							leftScore++;
							scoreLeftEl.innerText = leftScore;
							bullets.splice(i, 1);
							
							// æ£€æŸ¥èƒœåˆ©
							if (leftScore >= config.winScore) {
								victoryMsg.style.display = 'block';
								victoryMsg.innerHTML = 'ğŸ† è“æ–¹èƒœåˆ© ğŸ†<div><button class="restart-btn" onclick="location.reload()">å†ç©ä¸€å±€</button></div>';
								gameActive = false;
								return;
							}
							
							// é‡ç½®ä½ç½®å¹¶åˆ‡æ¢åœ°å›¾
							leftPlayer = { x: 80, y: 200, r: config.playerRadius };
							rightPlayer = { x: 320, y: 200, r: config.playerRadius };
							generateRandomMap();
							bullets = [];
							break;
						}
					} else { // çº¢æ–¹å­å¼¹
						let dx = b.x - leftPlayer.x;
						let dy = b.y - leftPlayer.y;
						let dist = Math.sqrt(dx*dx + dy*dy);
						if (dist < b.r + leftPlayer.r) {
							// çº¢æ–¹å‡»ä¸­è“æ–¹ï¼Œçº¢æ–¹å¾—åˆ†
							rightScore++;
							scoreRightEl.innerText = rightScore;
							bullets.splice(i, 1);
							
							if (rightScore >= config.winScore) {
								victoryMsg.style.display = 'block';
								victoryMsg.innerHTML = 'ğŸ† çº¢æ–¹èƒœåˆ© ğŸ†<div><button class="restart-btn" onclick="location.reload()">å†ç©ä¸€å±€</button></div>';
								gameActive = false;
								return;
							}
							
							leftPlayer = { x: 80, y: 200, r: config.playerRadius };
							rightPlayer = { x: 320, y: 200, r: config.playerRadius };
							generateRandomMap();
							bullets = [];
							break;
						}
					}
				}

				// å†·å´æ›´æ–°
				if (leftCooldown > 0) leftCooldown--;
				if (rightCooldown > 0) rightCooldown--;
			}

			// ç»˜åˆ¶éšœç¢ç‰©
			function drawObstacles() {
				for (let obs of obstacles) {
					ctx.shadowBlur = 15;
					ctx.shadowColor = '#00000080';
					
					if (obs.type === 0) { // åœ†å½¢éšœç¢
						ctx.beginPath();
						ctx.arc(obs.x, obs.y, obs.radius, 0, Math.PI*2);
						ctx.fillStyle = '#8b5a2b';
						ctx.fill();
						ctx.strokeStyle = '#5a3a1a';
						ctx.lineWidth = 3;
						ctx.stroke();
						
						// çº¹ç†
						ctx.fillStyle = '#a8753a';
						for (let i = 0; i < 3; i++) {
							let angle = (i / 3) * Math.PI * 2;
							let x1 = obs.x + Math.cos(angle) * obs.radius * 0.5;
							let y1 = obs.y + Math.sin(angle) * obs.radius * 0.5;
							ctx.beginPath();
							ctx.arc(x1, y1, 4, 0, Math.PI*2);
							ctx.fill();
						}
					} else if (obs.type === 1) { // çŸ©å½¢éšœç¢
						ctx.save();
						ctx.translate(obs.x, obs.y);
						ctx.rotate(obs.rotation);
						ctx.fillStyle = '#5d6d7e';
						ctx.fillRect(-obs.width/2, -obs.height/2, obs.width, obs.height);
						ctx.strokeStyle = '#2c3e50';
						ctx.lineWidth = 3;
						ctx.strokeRect(-obs.width/2, -obs.height/2, obs.width, obs.height);
						
						// çº¹ç†
						ctx.fillStyle = '#778899';
						for (let i = -1; i <= 1; i++) {
							ctx.fillRect(-obs.width/2 + 5, i * 10 - 5, obs.width - 10, 2);
						}
						ctx.restore();
					} else if (obs.type === 2) { // åå­—éšœç¢
						ctx.save();
						ctx.translate(obs.x, obs.y);
						ctx.fillStyle = '#b87333';
						ctx.shadowBlur = 15;
						// æ°´å¹³æ¡
						ctx.fillRect(-25, -8, 50, 16);
						// å‚ç›´æ¡
						ctx.fillRect(-8, -25, 16, 50);
						ctx.strokeStyle = '#8b4513';
						ctx.lineWidth = 3;
						ctx.strokeRect(-25, -8, 50, 16);
						ctx.strokeRect(-8, -25, 16, 50);
						ctx.restore();
					}
				}
				ctx.shadowBlur = 0;
			}

			let gameActive = true;

			// ç»˜åˆ¶
			function draw() {
				if (!gameActive) return;
				
				ctx.clearRect(0, 0, canvas.width, canvas.height);

				// èƒŒæ™¯æ¸å˜
				const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
				gradient.addColorStop(0, '#87CEEB');
				gradient.addColorStop(1, '#B0E0F0');
				ctx.fillStyle = gradient;
				ctx.fillRect(0, 0, canvas.width, canvas.height);

				// ç»˜åˆ¶éšœç¢ç‰©
				drawObstacles();

				// ä¸­çº¿
				ctx.strokeStyle = '#ffffff55';
				ctx.lineWidth = 2;
				ctx.setLineDash([10, 10]);
				ctx.beginPath();
				ctx.moveTo(canvas.width/2, 0);
				ctx.lineTo(canvas.width/2, canvas.height);
				ctx.stroke();
				ctx.setLineDash([]);

				// ç»˜åˆ¶å·¦ç©å®¶
				ctx.shadowBlur = 15;
				ctx.shadowColor = '#00000080';
				
				// é£æœºèº«ä½“
				ctx.beginPath();
				ctx.moveTo(leftPlayer.x, leftPlayer.y - 15);
				ctx.lineTo(leftPlayer.x + 12, leftPlayer.y + 8);
				ctx.lineTo(leftPlayer.x + 4, leftPlayer.y + 8);
				ctx.lineTo(leftPlayer.x, leftPlayer.y + 15);
				ctx.lineTo(leftPlayer.x - 4, leftPlayer.y + 8);
				ctx.lineTo(leftPlayer.x - 12, leftPlayer.y + 8);
				ctx.closePath();
				ctx.fillStyle = '#3b82f6';
				ctx.fill();
				ctx.strokeStyle = '#1e3a8a';
				ctx.lineWidth = 2;
				ctx.stroke();
				
				// é©¾é©¶èˆ±
				ctx.beginPath();
				ctx.arc(leftPlayer.x, leftPlayer.y - 6, 5, 0, Math.PI, true);
				ctx.fillStyle = '#a5d8ff';
				ctx.fill();

				// ç»˜åˆ¶å³ç©å®¶
				ctx.beginPath();
				ctx.moveTo(rightPlayer.x, rightPlayer.y - 15);
				ctx.lineTo(rightPlayer.x + 12, rightPlayer.y + 8);
				ctx.lineTo(rightPlayer.x + 4, rightPlayer.y + 8);
				ctx.lineTo(rightPlayer.x, rightPlayer.y + 15);
				ctx.lineTo(rightPlayer.x - 4, rightPlayer.y + 8);
				ctx.lineTo(rightPlayer.x - 12, rightPlayer.y + 8);
				ctx.closePath();
				ctx.fillStyle = '#dc2626';
				ctx.fill();
				ctx.strokeStyle = '#991b1b';
				ctx.stroke();
				
				ctx.beginPath();
				ctx.arc(rightPlayer.x, rightPlayer.y - 6, 5, 0, Math.PI, true);
				ctx.fillStyle = '#ffa5a5';
				ctx.fill();

				// å­å¼¹
				for (let b of bullets) {
					ctx.beginPath();
					ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
					ctx.fillStyle = b.side === 'left' ? '#3b82f6' : '#dc2626';
					ctx.shadowBlur = 15;
					ctx.fill();
					
					// å°¾ç„°
					ctx.beginPath();
					ctx.arc(b.x - b.vx * 0.8, b.y - b.vy * 0.8, b.r * 0.6, 0, Math.PI*2);
					ctx.fillStyle = '#ffff00';
					ctx.fill();
				}

				// å†·å´æŒ‡ç¤º
				ctx.shadowBlur = 0;
				if (leftCooldown > 0) {
					ctx.fillStyle = '#ffffff';
					ctx.font = 'bold 14px sans-serif';
					ctx.fillText('â³', leftPlayer.x - 30, leftPlayer.y - 30);
				}
				if (rightCooldown > 0) {
					ctx.fillStyle = '#ffffff';
					ctx.font = 'bold 14px sans-serif';
					ctx.fillText('â³', rightPlayer.x + 20, rightPlayer.y - 30);
				}
			}

			// æ¸¸æˆå¾ªç¯
			function gameLoop() {
				if (gameActive) {
					updatePlayers();
					updateBullets();
					draw();
				}
				requestAnimationFrame(gameLoop);
			}
			gameLoop();

			// é˜»æ­¢æ»šåŠ¨
			document.body.addEventListener('touchmove', (e) => {
				if (e.target.closest('button')) {
					e.preventDefault();
				}
			}, { passive: false });
		})();
	</script>
</body>
</html>